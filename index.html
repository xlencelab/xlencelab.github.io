<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Xlence AI - Create Smarter With AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --primary: #1a1a1a;
            --secondary: #333;
            --accent: #666;
            --text: #f5f5f5;
            --bg: #121212;
            --gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-text-color: #f5f5f5; /* Default for dark mode */
        }

        /* Light Mode Variables */
        body.light-mode {
            --primary: #f0f0f0;
            --secondary: #e0e0e0;
            --accent: #999;
            --text: #333;
            --bg: #ffffff;
            --gradient: linear-gradient(135deg, #4CAF50 0%, #2196F3 100%); /* Example light mode gradient */
            --gradient-text-color: #333; /* Darker text for light mode gradient */
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg);
            color: var(--text);
            overflow-x: hidden;
            transition: all 0.5s ease;
        }
        
        .nav-item {
            position: relative;
            overflow: hidden;
            cursor: pointer;
            color: var(--text); /* Ensure nav item text color adapts */
        }
        
        .nav-item::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 2px;
            background: var(--gradient);
            transition: width 0.3s ease;
        }
        
        .nav-item:hover::after {
            width: 100%;
        }
        
        .nav-item.active::after {
            width: 100%;
        }
        
        .page {
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.6s cubic-bezier(0.16, 1, 0.3, 1);
            display: none;
            /* Ensure pages can scroll independently if content overflows */
            overflow-y: auto; 
            height: 100%; /* Take full height of main-content */
        }
        
        .page.active {
            opacity: 1;
            transform: translateY(0);
            display: block;
        }
        
        .message {
            max-width: 80%;
            padding: 12px 16px;
            margin: 8px 0;
            border-radius: 18px;
            animation: fadeIn 0.4s ease-out;
            transform-origin: bottom;
        }
        
        .user-message {
            background: var(--gradient);
            margin-left: auto;
            border-bottom-right-radius: 4px;
            color: white; /* User message text should remain white for contrast */
        }
        
        .ai-message {
            background-color: var(--primary);
            margin-right: auto;
            border-bottom-left-radius: 4px;
            border: 1px solid var(--secondary);
            color: var(--text); /* Ensure AI message text color adapts */
        }

        /* Added styles for AI message formatting */
        .ai-message p {
            white-space: pre-wrap; /* Preserve whitespace and line breaks */
            color: var(--text); /* Ensure paragraph text color adapts */
        }

        .ai-message strong {
            font-weight: bold;
            color: var(--gradient); /* Apply gradient to bold text */
        }

        .ai-message ul {
            list-style-type: disc;
            margin-left: 20px;
            padding-left: 5px;
        }

        .ai-message ol {
            list-style-type: decimal;
            margin-left: 20px;
            padding-left: 5px;
        }

        .ai-message li {
            margin-bottom: 5px;
        }
        
        .review-card {
            background: linear-gradient(145deg, var(--primary), var(--secondary));
            transform: perspective(1000px) rotateY(15deg);
            transition: all 0.4s ease;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            border: 1px solid rgba(255,255,255,0.1);
            color: var(--text); /* Ensure review card text color adapts */
        }
        
        .review-card:hover {
            transform: perspective(1000px) rotateY(0deg) translateY(-10px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.3);
        }
        
        .team-member {
            opacity: 0;
            transform: translateY(30px);
            transition: all 0.5s ease;
            background: linear-gradient(145deg, var(--primary), var(--secondary));
            border: 1px solid rgba(255,255,255,0.1);
            color: var(--text); /* Ensure team member text color adapts */
        }
        
        .team-member.visible {
            opacity: 1;
            transform: translateY(0);
        }
        
        .typing-indicator {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            background-color: var(--primary);
            border-radius: 18px;
            border-bottom-left-radius: 4px;
            max-width: 80%;
            margin: 8px 0;
            border: 1px solid var(--secondary);
            color: var(--text); /* Ensure typing indicator text color adapts */
        }
        
        .typing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: var(--text);
            margin: 0 2px;
            animation: typing 1.4s infinite ease-in-out;
        }
        
        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        
        @keyframes typing {
            0%, 80%, 100% {
                transform: scale(0);
                opacity: 0.5;
            }
            40% {
                transform: scale(1);
                opacity: 1;
            }
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes float {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-10px);
            }
        }
        
        .floating {
            animation: float 6s ease-in-out infinite;
        }
        
        .gradient-text {
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            color: var(--gradient-text-color); /* Fallback for non-webkit, but primarily for contrast */
        }
        
        /* Custom Scrollbar Styles */
        .custom-scrollbar {
            scrollbar-width: thin;
            scrollbar-color: rgba(255, 255, 255, 0.2) transparent;
        }
        
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-track {
            background: transparent;
            border-radius: 10px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 10px;
            transition: all 0.3s ease;
            animation: scrollPulse 2s ease-in-out infinite;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
            animation: none;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb:active {
            background: rgba(255, 255, 255, 0.4);
        }
        
        @keyframes scrollPulse {
            0%, 100% {
                background: rgba(255, 255, 255, 0.15);
                transform: scaleY(1);
            }
            50% {
                border-color: rgba(255, 255, 255, 0.6); /* Added for pulse effect */
                box-shadow: 0 0 20px 5px rgba(102, 126, 234, 0.8); /* Added for pulse effect */
                transform: scaleY(1.1);
            }
        }
        
        /* Mobile specific styles */
        @media (max-width: 768px) {
            body {
                display: flex;
                flex-direction: column;
                height: 100vh; /* Full viewport height */
            }

            /* Hide old nav menu on mobile */
            .nav-menu {
                display: none;
            }
            
            .main-content {
                margin-left: 0; /* No left margin on mobile */
                width: 100%;
                flex-grow: 1; /* Allow main content to take available space */
                overflow-y: auto; /* Enable scrolling for main content */
                padding-bottom: 20px; /* Adjust padding for new sidebar */
                padding-top: 60px; /* Add padding to prevent content from being under the toggle button */
            }
            
            .message {
                max-width: 90%;
            }

            .notes-container {
                flex-direction: column;
                height: auto; /* Allow height to adjust */
            }

            .notes-sidebar {
                width: 100%;
                height: auto;
                max-height: 200px; /* Limit height on mobile */
                margin-bottom: 1rem;
            }

            .notes-editor {
                width: 100%;
            }

            .review-card {
                transform: none; /* Remove 3D transform on mobile */
                margin-bottom: 1rem; /* Add some space between cards */
            }

            .review-card:hover {
                transform: none; /* Remove hover transform on mobile */
            }

            .team-member {
                margin-bottom: 1rem; /* Add space between team members */
            }

            .modal-content {
                width: 95%; /* Slightly wider modal on small screens */
                padding: 1.5rem;
            }
        }
        
        /* Tablet specific styles (adjust as needed, often between 768px and 1024px) */
        @media (min-width: 769px) and (max-width: 1024px) {
            body {
                display: flex;
                flex-direction: row; /* Sidebar on left */
                height: 100vh;
            }

            /* Hide old nav menu on tablet */
            .nav-menu {
                display: none;
            }

            .main-content {
                margin-left: 0; /* No left margin on tablet */
                width: 100%;
                flex-grow: 1;
                overflow-y: auto; /* Enable scrolling for main content */
                padding-top: 60px; /* Add padding to prevent content from being under the toggle button */
            }

            .chat-container {
                max-width: 700px; /* Adjust chat width */
            }

            .notes-sidebar {
                width: 200px; /* Adjust sidebar width */
            }
        }

        /* Desktop specific styles */
        @media (min-width: 1025px) { /* Changed from 769px to 1025px for clearer desktop breakpoint */
            body {
                display: flex;
                flex-direction: row; /* Sidebar on left */
                height: 100vh;
            }

            /* Hide old nav menu on desktop */
            .nav-menu {
                display: none;
            }
            
            .main-content {
                margin-left: 0; /* No left margin on desktop */
                width: calc(100%);
                flex-grow: 1;
                overflow-y: auto; /* Enable scrolling for main content */
                padding-top: 20px; /* Adjust padding for desktop, less critical than mobile */
            }
            
            .chat-container {
                max-width: 800px;
                margin: 0 auto;
            }

            .notes-container {
                flex-direction: row;
                height: calc(100vh - 100px); /* Restore desktop height */
            }

            .notes-sidebar {
                width: 250px;
                height: calc(100vh - 100px); /* Restore desktop height */
                margin-right: 1.5rem;
            }

            .notes-editor {
                flex-grow: 1;
            }
        }

        /* Custom Sign-in/Sign-up Button Styling */
        .auth-button {
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: transparent; /* Transparent background */
            color: var(--text); /* Use text color for monochrome effect */
            border: 1px solid var(--accent); /* Subtle border */
            border-radius: 5px;
            padding: 8px 12px; /* Adjusted padding for better fit */
            cursor: pointer;
            font-family: 'Inter', sans-serif; /* Use Inter font */
            font-size: 14px; /* Adjusted font size */
            font-weight: 500;
            box-shadow: none; /* Remove shadow */
            transition: all 0.3s ease;
            width: 100%; /* Make it take full width of its container */
            max-width: 160px; /* Limit max width for desktop nav */
            margin: 0 auto; /* Center in nav for desktop */
        }

        .auth-button:hover {
            background-color: rgba(255, 255, 255, 0.08); /* Subtle hover effect */
        }

        .auth-button svg {
            width: 18px; /* Adjusted icon size */
            height: 18px; /* Adjusted icon size */
            margin-right: 8px; /* Adjusted margin */
        }

        /* Modal Styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .modal.show {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: var(--primary);
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            width: 90%;
            max-width: 400px;
            position: relative;
            transform: translateY(-20px);
            transition: transform 0.3s ease;
            color: var(--text); /* Ensure modal content text color adapts */
        }

        .modal.show .modal-content {
            transform: translateY(0);
        }

        .modal-close-button {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--text);
            cursor: pointer;
        }

        .modal-input {
            width: 100%;
            padding: 0.75rem;
            margin-bottom: 1rem;
            border: 1px solid var(--secondary);
            border-radius: 5px;
            background-color: var(--bg);
            color: var(--text);
        }

        .modal-submit-button {
            width: 100%;
            padding: 0.75rem;
            border-radius: 5px;
            background: var(--gradient);
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: opacity 0.3s ease;
        }

        .modal-submit-button:hover {
            opacity: 0.9;
        }

        .modal-switch-text {
            text-align: center;
            margin-top: 1rem;
            color: var(--accent);
        }

        .modal-switch-text span {
            cursor: pointer;
            color: var(--gradient);
            font-weight: bold;
        }

        /* Custom Toast Notification */
        .toast-notification {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease, transform 0.3s ease;
            z-index: 1001;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .toast-notification.show {
            opacity: 1;
            visibility: visible;
            transform: translateX(-50%) translateY(-10px);
        }

        .toast-notification.success {
            background-color: #4CAF50; /* Green for success */
        }

        .toast-notification.error {
            background-color: #f44336; /* Red for error */
        }

        /* Seed Phrase Display */
        .seed-phrase-display {
            background-color: var(--secondary);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            text-align: center;
            font-size: 1.1rem;
            font-weight: bold;
            color: var(--gradient);
            word-break: break-all;
        }

        /* Notes Specific Styles */
        .notes-container {
            display: flex;
            gap: 1.5rem;
            height: calc(100vh - 100px); /* Adjust based on header/footer if any */
        }

        .notes-sidebar {
            background: var(--primary);
            border: 1px solid var(--secondary);
            border-radius: 10px;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            color: var(--text); /* Ensure notes sidebar text color adapts */
        }

        .notes-sidebar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .notes-list {
            flex-grow: 1;
            overflow-y: auto;
            padding-right: 0.5rem; /* For scrollbar */
        }

        .notes-list-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            background-color: var(--secondary);
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s ease;
            color: var(--text); /* Ensure notes list item text color adapts */
        }

        .notes-list-item:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .notes-list-item.active {
            background: var(--gradient);
            color: white;
        }

        .notes-list-item-title {
            flex-grow: 1;
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .notes-delete-btn {
            background: none;
            border: none;
            color: var(--accent);
            cursor: pointer;
            margin-left: 0.5rem;
            transition: color 0.2s ease;
        }

        .notes-list-item.active .notes-delete-btn {
            color: white; /* Adjust color for active state */
        }

        .notes-delete-btn:hover {
            color: #f44336; /* Red for delete hover */
        }

        .notes-editor {
            background: var(--primary);
            border: 1px solid var(--secondary);
            border-radius: 10px;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            color: var(--text); /* Ensure notes editor text color adapts */
        }

        .notes-editor-title {
            width: 100%;
            padding: 0.75rem;
            margin-bottom: 1rem;
            border: 1px solid var(--accent);
            border-radius: 5px;
            background-color: var(--bg);
            color: var(--text);
            font-size: 1.25rem;
            font-weight: bold;
        }

        .notes-editor-content {
            flex-grow: 1;
            width: 100%;
            padding: 1rem;
            border: 1px solid var(--accent);
            border-radius: 5px;
            background-color: var(--bg);
            color: var(--text);
            font-size: 1rem;
            line-height: 1.5;
            resize: vertical; /* Allow vertical resizing */
            min-height: 200px; /* Minimum height for editor */
        }

        .notes-editor-actions {
            display: flex;
            justify-content: flex-end;
            margin-top: 1rem;
            gap: 1rem;
        }

        .notes-editor-save-btn {
            padding: 0.75rem 1.5rem;
            border-radius: 5px;
            background: var(--gradient);
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: opacity 0.3s ease;
        }

        .notes-editor-save-btn:hover {
            opacity: 0.9;
        }

        .notes-editor-new-btn {
            padding: 0.75rem 1.5rem;
            border-radius: 5px;
            background-color: var(--accent);
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .notes-editor-new-btn:hover {
            background-color: #555;
        }

        .notes-no-user-message {
            text-align: center;
            padding: 2rem;
            background: var(--primary);
            border-radius: 10px;
            margin-top: 2rem;
            color: var(--text); /* Ensure no user message text color adapts */
        }

        /* Theme Switcher Button */
        .theme-switcher {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            background-color: var(--primary);
            border: 1px solid var(--secondary);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }

        .theme-switcher:hover {
            background-color: var(--secondary);
        }

        .theme-switcher svg {
            width: 24px;
            height: 24px;
            color: var(--text);
            transition: color 0.3s ease;
        }

        /* Specific overrides for elements that need to maintain contrast */
        .chat-dropdown button {
            color: var(--text); /* Ensure dropdown button text color adapts */
        }

        .chat-dropdown button:hover {
            background-color: var(--secondary); /* Ensure hover background adapts */
        }

        .chat-dropdown .text-gray-400 {
            color: var(--accent); /* Adjust for better visibility in light mode */
        }

        .chat-dropdown .text-white {
            color: var(--text); /* Ensure chat history title text color adapts */
        }

        .chat-dropdown .bg-gray-800 {
            background-color: var(--primary); /* Ensure dropdown background adapts */
            border-color: var(--secondary); /* Ensure dropdown border adapts */
        }

        .chat-dropdown .bg-gray-700 {
            background-color: var(--secondary); /* Ensure active/hover background adapts */
        }

        .chat-dropdown .text-red-400 {
            color: #f44336; /* Keep red for error/delete */
        }

        .chat-dropdown .text-green-400 {
            color: #4CAF50; /* Keep green for success/new chat */
        }

        .chat-dropdown .text-blue-400 {
            color: #2196F3; /* Keep blue for info */
        }

        .review-card .text-gray-300 {
            color: var(--text); /* Ensure review text color adapts */
        }

        .review-card .text-gray-400 {
            color: var(--accent); /* Ensure sub-text color adapts */
        }

        .pricing ul span {
            color: var(--text); /* Ensure pricing list item text color adapts */
        }

        .pricing .text-gray-400 {
            color: var(--accent); /* Ensure pricing sub-text color adapts */
        }

        .modal-switch-text span {
            color: var(--gradient);
            font-weight: bold;
        }

        .seed-phrase-display {
            color: var(--gradient);
        }

        .notes-list-item.active .notes-list-item-title {
            color: white;
        }

        .notes-list-item.active .notes-delete-btn {
            color: white;
        }

        .notes-sidebar-header h2 {
            color: var(--text);
        }

        .notes-editor-actions button {
            color: white;
        }

        .notes-editor-new-btn {
            background-color: var(--accent);
        }

        .notes-editor-new-btn:hover {
            background-color: var(--secondary);
        }

        /* Input fields */
        input[type="text"], textarea {
            background-color: var(--bg);
            color: var(--text);
            border-color: var(--secondary);
        }
        input[type="text"]:focus, textarea:focus {
            border-color: var(--gradient);
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.5);
        }

        /* Specific fix for chat input background */
        #user-input {
            background-color: var(--primary);
            color: var(--text);
            border-color: var(--secondary);
        }
        #user-input:focus {
            border-color: var(--gradient);
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.5);
        }

        /* Adjust chat dropdown button colors */
        #chat-dropdown-btn {
            background-color: var(--primary);
            border-color: var(--secondary);
            color: var(--text);
        }
        #chat-dropdown-btn:hover {
            background-color: var(--secondary);
        }

        /* Adjust chat dropdown content colors */
        #chat-dropdown {
            background-color: var(--primary);
            border-color: var(--secondary);
        }
        #chat-dropdown button {
            color: var(--text);
        }
        #chat-dropdown button:hover {
            background-color: var(--secondary);
        }
        #chat-dropdown .border-gray-600 {
            border-color: var(--secondary);
        }

        /* New styles for icon-only buttons */
        .nav-item-icon-only {
            padding: 8px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            color: var(--text);
            background-color: transparent;
            border: 1px solid var(--accent);
        }

        .nav-item-icon-only:hover {
            background-color: rgba(255, 255, 255, 0.08);
        }

        .nav-item-icon-only svg {
            margin-right: 0;
            width: 20px;
            height: 20px;
        }

        .nav-item-icon-only span {
            display: none;
        }

        /* Connect Page Specific Styles */
        .connect-container {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .connect-section {
            background: linear-gradient(145deg, var(--primary), var(--secondary));
            border: 1px solid var(--secondary);
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            color: var(--text);
        }

        .connect-section h2 {
            font-size: 1.75rem;
            font-weight: bold;
            margin-bottom: 1rem;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .group-card {
            background-color: var(--secondary);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 0.75rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .group-card button {
            background: var(--gradient);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            font-weight: bold;
            transition: opacity 0.3s ease;
        }

        .group-card button:hover {
            opacity: 0.9;
        }

        .friend-search-input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--accent);
            border-radius: 5px;
            background-color: var(--bg);
            color: var(--text);
            margin-bottom: 1rem;
        }

        .chat-list-item {
            background-color: var(--secondary);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            cursor: pointer;
        }

        .chat-list-item:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .chat-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 1rem;
        }

        /* About Us Page Specific Styles */
        .about-us-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .stat-card {
            background: linear-gradient(145deg, var(--primary), var(--secondary));
            border: 1px solid var(--secondary);
            border-radius: 10px;
            padding: 2rem;
            text-align: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            color: var(--text);
        }

        .stat-card h3 {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 1rem;
            color: var(--gradient);
        }

        .stat-card .number {
            font-size: 3rem;
            font-weight: bold;
            color: var(--text);
            display: block;
            margin-bottom: 0.5rem;
        }

        .stat-card .stars {
            font-size: 2rem;
            color: gold;
        }

        /* Profile Page Specific Styles */
        .profile-container {
            max-width: 600px;
            margin: 0 auto;
            padding: 2rem;
            background: linear-gradient(145deg, var(--primary), var(--secondary));
            border: 1px solid var(--secondary);
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            color: var(--text);
            text-align: center;
        }

        .profile-avatar-wrapper {
            position: relative;
            width: 120px;
            height: 120px;
            margin: 0 auto 1.5rem;
            border-radius: 50%;
            overflow: hidden;
            background: var(--gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: 3px solid var(--gradient);
        }

        .profile-avatar {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }

        .profile-avatar-placeholder {
            font-size: 3rem;
            font-weight: bold;
            color: white;
        }

        .profile-avatar-edit-icon {
            position: absolute;
            bottom: 0;
            right: 0;
            background-color: rgba(0, 0, 0, 0.6);
            border-radius: 50%;
            padding: 0.5rem;
            color: white;
            font-size: 1.2rem;
        }

        .profile-input-group {
            margin-bottom: 1rem;
            text-align: left;
        }

        .profile-input-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: bold;
        }

        .profile-input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--accent);
            border-radius: 5px;
            background-color: var(--bg);
            color: var(--text);
        }

        .profile-textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--accent);
            border-radius: 5px;
            background-color: var(--bg);
            color: var(--text);
            min-height: 100px;
            resize: vertical;
        }

        .profile-status-options {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 1rem;
        }

        .profile-status-button {
            padding: 0.5rem 1rem;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid transparent;
        }

        .profile-status-button.active {
            border-color: var(--gradient);
        }

        .profile-status-active {
            background-color: #4CAF50;
            color: white;
        }

        .profile-status-idle {
            background-color: #FFC107;
            color: #333;
        }

        .profile-status-dnd {
            background-color: #f44336;
            color: white;
        }

        .profile-save-button {
            width: 100%;
            padding: 0.75rem;
            margin-top: 1.5rem;
            border-radius: 5px;
            background: var(--gradient);
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: opacity 0.3s ease;
        }

        .profile-save-button:hover {
            opacity: 0.9;
        }

        /* New Sidebar Styles */
        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            height: 100%;
            width: 0; /* Start hidden */
            max-width: 260px;
            background: var(--primary);
            box-shadow: 2px 0 10px rgba(0,0,0,0.3);
            z-index: 100;
            overflow-x: hidden;
            transition: width 0.3s ease, padding 0.3s ease;
            display: flex;
            flex-direction: column;
            padding-top: 1rem; /* Initial padding */
        }

        .sidebar.open {
            width: 260px; /* Full width when open */
            padding: 1rem;
        }

        .sidebar-toggle {
            position: fixed;
            top: 1rem;
            left: 1rem;
            /* Increased z-index to ensure it's on top of all other content */
            z-index: 99999; 
            background: var(--primary);
            border: 1px solid var(--secondary);
            border-radius: 50%;
            width: 48px; /* Increased size for better touch target */
            height: 48px; /* Increased size for better touch target */
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }

        .sidebar-toggle:hover {
            background-color: var(--secondary);
        }

        .sidebar-toggle svg {
            width: 24px;
            height: 24px;
            color: var(--text);
        }

        .sidebar-close-btn {
            align-self: flex-end;
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--text);
            cursor: pointer;
            margin-bottom: 1rem;
        }

        .sidebar-nav-item {
            display: flex;
            align-items: center;
            padding: 10px 15px;
            margin-bottom: 0.5rem;
            border-radius: 8px;
            transition: background-color 0.3s ease;
            cursor: pointer;
            color: var(--text);
        }

        .sidebar-nav-item:hover {
            background-color: var(--secondary);
        }

        .sidebar-nav-item.active {
            background: var(--gradient);
            color: white;
        }

        .sidebar-nav-item svg {
            margin-right: 10px;
            width: 20px;
            height: 20px;
        }

        .sidebar-auth-container {
            margin-top: auto; /* Pushes to the bottom */
            padding: 1rem;
            border-top: 1px solid var(--secondary);
        }

        /* Saat sidebar tertutup */
        #sidebar {
             transform: translateX(-100%);
             transition: transform 0.3s ease;
         }

        /* Saat sidebar terbuka */
        #sidebar.open {
             transform: translateX(0);
        }

        /* Vault Page Specific Styles */
        .vault-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: calc(100vh - 100px); /* Adjust based on header/footer */
            text-align: center;
            font-family: 'Arial', sans-serif; /* Modern sans-serif font */
        }

        .planet-container {
            position: relative;
            width: 200px;
            height: 200px;
            margin-bottom: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transform-style: preserve-3d; /* Enable 3D transformations for children */
        }

        .planet {
            width: 100px;
            height: 100px;
            background: radial-gradient(circle at 30% 30%, #8e2de2, #4a00e0); /* Glowing effect */
            border-radius: 50%;
            box-shadow: 0 0 20px 5px rgba(142, 45, 226, 0.7); /* Outer glow */
            position: relative;
            z-index: 10;
        }

        .orbit-ring {
            position: absolute;
            border-radius: 50%;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-sizing: border-box;
            z-index: 5;
            /* Ensure rings are flat in 3D space */
            transform-style: preserve-3d;
            backface-visibility: hidden; /* Hide back of the ring when rotated */
            /* Added glow and pulse */
            box-shadow: 0 0 10px 2px rgba(102, 126, 234, 0.5); /* Subtle glow */
            animation: ringPulse 3s infinite ease-in-out; /* Keep pulse */
        }

        /* Individual orbit animations for varied rotation */
        .orbit-ring:nth-child(1) {
            width: 150px;
            height: 150px;
            /* Removed initial animation to control with JS */
            transform: rotateX(60deg) rotateZ(0deg);
        }

        .orbit-ring:nth-child(2) {
            width: 180px;
            height: 180px;
            /* Removed initial animation to control with JS */
            transform: rotateX(60deg) rotateZ(30deg);
        }

        .orbit-ring:nth-child(3) {
            width: 210px;
            height: 210px;
            /* Removed initial animation to control with JS */
            transform: rotateX(60deg) rotateZ(60deg);
        }

        .orbit-ring:nth-child(4) {
            width: 240px;
            height: 240px;
            /* Removed initial animation to control with JS */
            transform: rotateX(60deg) rotateZ(90deg);
        }

        /* Keyframes for varied rotation directions - now controlled by JS for interaction */
        @keyframes rotateOrbit1-cw {
            from { transform: rotateX(60deg) rotateZ(0deg); }
            to { transform: rotateX(60deg) rotateZ(360deg); } /* Clockwise */
        }

        @keyframes rotateOrbit1-ccw {
            from { transform: rotateX(60deg) rotateZ(0deg); }
            to { transform: rotateX(60deg) rotateZ(-360deg); } /* Counter-clockwise */
        }

        @keyframes rotateOrbit2-cw {
            from { transform: rotateX(60deg) rotateZ(30deg); }
            to { transform: rotateX(60deg) rotateZ(390deg); } /* Clockwise */
        }

        @keyframes rotateOrbit2-ccw {
            from { transform: rotateX(60deg) rotateZ(30deg); }
            to { transform: rotateX(60deg) rotateZ(-330deg); } /* Counter-clockwise */
        }

        @keyframes rotateOrbit3-cw {
            from { transform: rotateX(60deg) rotateZ(60deg); }
            to { transform: rotateX(60deg) rotateZ(420deg); } /* Clockwise */
        }

        @keyframes rotateOrbit3-ccw {
            from { transform: rotateX(60deg) rotateZ(60deg); }
            to { transform: rotateX(60deg) rotateZ(-300deg); } /* Counter-clockwise */
        }

        @keyframes rotateOrbit4-cw {
            from { transform: rotateX(60deg) rotateZ(90deg); }
            to { transform: rotateX(60deg) rotateZ(450deg); } /* Clockwise */
        }

        @keyframes rotateOrbit4-ccw {
            from { transform: rotateX(60deg) rotateZ(90deg); }
            to { transform: rotateX(60deg) rotateZ(-270deg); } /* Counter-clockwise */
        }

        /* Animation for the rings' glow/pulse */
        @keyframes ringPulse {
            0% {
                border-color: rgba(255, 255, 255, 0.3);
                box-shadow: 0 0 10px 2px rgba(102, 126, 234, 0.5);
            }
            50% {
                border-color: rgba(255, 255, 255, 0.6);
                box-shadow: 0 0 20px 5px rgba(102, 126, 234, 0.8);
            }
            100% {
                border-color: rgba(255, 255, 255, 0.3);
                box-shadow: 0 0 10px 2px rgba(102, 126, 234, 0.5);
            }
        }

        /* Adjust for light mode */
        body.light-mode .planet {
            background: radial-gradient(circle at 30% 30%, #66bb6a, #2e7d32);
            box-shadow: 0 0 20px 5px rgba(76, 175, 80, 0.7);
        }

        body.light-mode .orbit-ring {
            border: 1px solid rgba(0, 0, 0, 0.3);
            box-shadow: 0 0 10px 2px rgba(76, 175, 80, 0.5); /* Light mode glow */
        }

        body.light-mode @keyframes ringPulse {
            0% {
                border-color: rgba(0, 0, 0, 0.3);
                box-shadow: 0 0 10px 2px rgba(76, 175, 80, 0.5);
            }
            50% {
                border-color: rgba(0, 0, 0, 0.6);
                box-shadow: 0 0 20px 5px rgba(76, 175, 80, 0.8);
            }
            100% {
                border-color: rgba(0, 0, 0, 0.3);
                box-shadow: 0 0 10px 2px rgba(76, 175, 80, 0.5);
            }
        }
    </style>
</head>
<body>
    <!-- Hamburger Toggle Button -->
    <button id="sidebar-toggle" class="sidebar-toggle">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
        </svg>
    </button>

    <!-- Unified Sidebar -->
    <div id="sidebar" class="sidebar">
        <button id="sidebar-close-btn" class="sidebar-close-btn">&times;</button>
        
        <button onclick="switchPage('profile')" class="text-2xl font-bold mb-8 mt-4 text-center self-center sidebar-nav-item">
            <img src="https://cdn.pixabay.com/photo/2016/09/28/02/14/user-1699635_1280.png" alt="Anonymous Profile" class="h-8 w-auto rounded-full" />
            <span class="ml-2">Profile</span>
        </button>
        
        <button onclick="switchPage('chat')" class="sidebar-nav-item active">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
            </svg>
            <span>Chat</span>
        </button>
        
        <button onclick="switchPage('notes')" class="sidebar-nav-item">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" />
            </svg>
            <span>Notes</span>
        </button>

        <!-- Removed Connect Button -->
        <!--
        <button onclick="switchPage('connect')" class="sidebar-nav-item">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.121 17.804A13.937 13.937 0 0112 16c2.5 0 4.847.655 6.879 1.804M15 10a3 3 0 11-6 0 3 3 0 016 0zm6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <span>Connect</span>
        </button>
        -->

        <button onclick="switchPage('about-us')" class="sidebar-nav-item">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <span>About Us</span>
        </button>

        <button onclick="switchPage('reviews')" class="sidebar-nav-item">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z" />
            </svg>
            <span>Reviews</span>
        </button>

        <button onclick="switchPage('pricing')" class="sidebar-nav-item">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z" />
            </svg>
            <span>Models</span>
        </button>

        <button onclick="switchPage('vault')" class="sidebar-nav-item">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v3h8z" />
            </svg>
            <span>Vault</span>
        </button>

        <!-- Auth Container -->
        <div class="sidebar-auth-container">
            <button id="auth-button" class="auth-button" onclick="showAuthModal('signin')">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1" />
                </svg>
                <span id="auth-button-text">Sign In</span>
            </button>
        </div>
    </div>

    <!-- Main Content -->
    <main class="main-content min-h-screen">
        <!-- Chat Page -->
        <div id="chat" class="page active p-4 md:p-8 chat-container">
            <div class="max-w-4xl mx-auto">
                <div class="flex items-center justify-between mb-6">
                    <h1 id="chat-greeting" class="text-3xl md:text-4xl font-bold gradient-text">Welcome!</h1>
                    
                    <!-- Chat Dropdown Menu -->
                    <div class="relative">
                        <button id="chat-dropdown-btn" class="flex items-center space-x-2 px-4 py-2 bg-gray-800 hover:bg-gray-700 rounded-lg transition-all duration-300 border border-gray-600">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z" />
                            </svg>
                            <span>Chat Options</span>
                            <svg id="dropdown-arrow" xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 transition-transform duration-200" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                            </svg>
                        </button>
                        
                        <div id="chat-dropdown" class="absolute right-0 top-12 w-96 bg-gray-800 border border-gray-600 rounded-lg shadow-xl opacity-0 invisible transform scale-95 transition-all duration-200 z-50 flex flex-row flex-wrap justify-between items-start p-2">
                            
                            <!-- New Chat Button -->
                            <button onclick="startNewChat()" class="w-full flex items-center space-x-3 px-3 py-2 text-left hover:bg-gray-700 rounded-lg transition-all duration-200 mb-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-green-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                                </svg>
                                <span>New Chat</span>
                            </button>
                            
                            <!-- Chat History Section -->
                            <div class="w-full">
                                <div class="flex items-center space-x-2 px-3 py-2 mt-2 border-t border-gray-600">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-blue-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                                    </svg>
                                    <span class="text-sm text-gray-400 font-medium">Chat History</span>
                                </div>
                                
                                <!-- Chat History List -->
                                <div id="chat-history-list" class="max-h-48 overflow-y-auto custom-scrollbar">
                                    <!-- Dynamic chat history items will be inserted here -->
                                </div>
                            </div>
                            
                            <!-- Clear History Button -->
                            <div class="w-full border-t border-gray-600 pt-2 mt-2">
                                <button onclick="clearChatHistory()" class="w-full flex items-center space-x-3 px-3 py-2 text-left hover:bg-red-900/20 text-red-400 rounded-lg transition-all duration-200">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                    </svg>
                                    <span class="text-sm">Clear History</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div id="chat-messages" class="mb-6 space-y-4 max-h-96 overflow-y-auto custom-scrollbar">
                    <div class="ai-message">
                        <div class="font-medium mb-1 gradient-text">Xlence AI</div>
                        <p>Hello! How can I help you today?</p>
                    </div>
                </div>

                <!-- Prompt Templates Container -->
                <div id="prompt-templates" class="mb-4 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2">
                    <button class="prompt-template-btn p-2 rounded-lg bg-gray-700 text-white text-sm hover:bg-gray-600 transition-all duration-200">
                        Write a short story about a futuristic city.
                    </button>
                    <button class="prompt-template-btn p-2 rounded-lg bg-gray-700 text-white text-sm hover:bg-gray-600 transition-all duration-200">
                        Explain quantum physics in simple terms.
                    </button>
                    <button class="prompt-template-btn p-2 rounded-lg bg-gray-700 text-white text-sm hover:bg-gray-600 transition-all duration-200">
                        Give me ideas for a healthy dinner.
                    </button>
                </div>
                
                <div class="flex items-center space-x-2">
                    <input id="user-input" type="text" placeholder="Type your message..." 
                           class="flex-1 px-4 py-3 rounded-full bg-gray-800 focus:outline-none focus:ring-2 focus:ring-purple-500 transition-all border border-gray-700">
                    <button id="send-btn" class="p-3 rounded-full bg-gradient-to-r from-purple-500 to-indigo-600 hover:from-purple-600 hover:to-indigo-700 transition-all transform hover:scale-105">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
                        </svg>
                    </button>
                </div>
                <div id="response-limit-message" class="text-center text-red-400 mt-4 hidden">
                    You have reached your response limit.
                </div>
            </div>
        </div>
        
        <!-- Reviews Page -->
        <div id="reviews" class="page p-4 md:p-8">
            <div class="max-w-6xl mx-auto">
                <h1 class="text-3xl md:text-4xl font-bold mb-8 text-center gradient-text">Reviews</h1>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div class="review-card p-6 rounded-xl">
                        <div class="flex items-center mb-4">
                            <div class="w-12 h-12 rounded-full bg-gradient-to-r from-purple-500 to-indigo-600 flex items-center justify-center">
                                <span class="text-xl font-bold">U1</span>
                            </div>
                            <div class="ml-4">
                                <div class="font-bold">User </div>
                            </div>
                        </div>
                        <p class="text-gray-300">"The AI interface transformed our customer service. The sophisticated design and seamless functionality impressed both our team and clients."</p>
                        <div class="flex mt-4">
                            <span class="text-yellow-400">★★★★★</span>
                        </div>
                    </div>
                    
                    <div class="review-card p-6 rounded-xl">
                        <div class="flex items-center mb-4">
                            <div class="w-12 h-12 rounded-full bg-gradient-to-r from-green-500 to-blue-600 flex items-center justify-center">
                                <span class="text-xl font-bold">U2</span>
                            </div>
                            <div class="ml-4">
                                <div class="font-bold">User </div>
                            </div>
                        </div>
                        <p class="text-gray-300">"Outstanding user experience with intelligent responses. The interface is intuitive and the AI capabilities exceeded our expectations."</p>
                        <div class="flex mt-4">
                            <span class="text-yellow-400">★★★★★</span>
                        </div>
                    </div>
                    
                    <div class="review-card p-6 rounded-xl">
                        <div class="flex items-center mb-4">
                            <div class="w-12 h-12 rounded-full bg-gradient-to-r from-red-500 to-pink-600 flex items-center justify-center">
                                <span class="text-xl font-bold">U3</span>
                            </div>
                            <div class="ml-4">
                                <div class="font-bold">User</div>
                            </div>
                        </div>
                        <p class="text-gray-300">"Revolutionary AI technology with a beautiful interface. It's become an essential tool for our daily operations and customer interactions."</p>
                        <div class="flex mt-4">
                            <span class="text-yellow-400">★★★★★</span>
                        </div>
                    </div>

                    <div class="review-card p-6 rounded-xl">
                        <div class="flex items-center mb-4">
                            <div class="w-12 h-12 rounded-full bg-gradient-to-r from-yellow-500 to-orange-600 flex items-center justify-center">
                                <span class="text-xl font-bold">U4</span>
                            </div>
                            <div class="ml-4">
                                <div class="font-bold">User </div>
                            </div>
                        </div>
                        <p class="text-gray-300">"The AI has significantly boosted our productivity. The prompt templates are a game-changer for consistent and high-quality content generation."</p>
                        <div class="flex mt-4">
                            <span class="text-yellow-400">★★★★★</span>
                        </div>
                    </div>

                    <div class="review-card p-6 rounded-xl">
                        <div class="flex items-center mb-4">
                            <div class="w-12 h-12 rounded-full bg-gradient-to-r from-teal-500 to-cyan-600 flex items-center justify-center">
                                <span class="text-xl font-bold">U5</span>
                            </div>
                            <div class="ml-4">
                                <div class="font-bold">User </div>
                            </div>
                        </div>
                        <p class="text-gray-300">"Seamless integration and powerful AI. The prioritized responses for Pro users make a noticeable difference during peak hours."</p>
                        <div class="flex mt-4">
                            <span class="text-yellow-400">★★★★★</span>
                        </div>
                    </div>

                    <div class="review-card p-6 rounded-xl">
                        <div class="flex items-center mb-4">
                            <div class="w-12 h-12 rounded-full bg-gradient-to-r from-indigo-500 to-purple-600 flex items-center justify-center">
                                <span class="text-xl font-bold">U6</span>
                            </div>
                            <div class="ml-4">
                                <div class="font-bold">User </div>
                            </div>
                        </div>
                        <p class="text-gray-300">"As a developer, I appreciate the clean API and the robust performance. This AI is a solid foundation for any modern application."</p>
                        <div class="flex mt-4">
                            <span class="text-yellow-400">★★★★★</span>
                        </div>
                    </div>

                    <div class="review-card p-6 rounded-xl">
                        <div class="flex items-center mb-4">
                            <div class="w-12 h-12 rounded-full bg-gradient-to-r from-pink-500 to-red-600 flex items-center justify-center">
                                <span class="text-xl font-bold">U7</span>
                            </div>
                            <div class="ml-4">
                                <div class="font-bold">User </div>
                            </div>
                        </div>
                        <p class="text-gray-300">"Even the basic plan offers incredible value. It's helped me automate customer queries and save so much time."</p>
                        <div class="flex mt-4">
                            <span class="text-yellow-400">★★★★★</span>
                        </div>
                    </div>

                    <div class="review-card p-6 rounded-xl">
                        <div class="flex items-center mb-4">
                            <div class="w-12 h-12 rounded-full bg-gradient-to-r from-lime-500 to-green-600 flex items-center justify-center">
                                <span class="text-xl font-bold">U8</span>
                            </div>
                            <div class="ml-4">
                                <div class="font-bold">User </div>
                            </div>
                        </div>
                        <p class="text-gray-300">"An invaluable tool for educational purposes. It helps students with research and understanding complex topics quickly."</p>
                        <div class="flex mt-4">
                            <span class="text-yellow-400">★★★★★</span>
                        </div>
                    </div>

                    <div class="review-card p-6 rounded-xl">
                        <div class="flex items-center mb-4">
                            <div class="w-12 h-12 rounded-full bg-gradient-to-r from-gray-500 to-gray-600 flex items-center justify-center">
                                <span class="text-xl font-bold">U9</span>
                            </div>
                            <div class="ml-4">
                                <div class="font-bold">User </div>
                            </div>
                        </div>
                        <p class="text-gray-300">"The AI is a fantastic writing assistant. It helps overcome writer's block and generates creative ideas effortlessly."</p>
                        <div class="flex mt-4">
                            <span class="text-yellow-400">★★★★★</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Pricing Page -->
        <div id="pricing" class="page p-4 md:p-8">
            <div class="max-w-6xl mx-auto">
                <h1 class="text-3xl md:text-4xl font-bold mb-8 text-center gradient-text">Our XLC Models</h1>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <!-- Basic Plan Card -->
                    <div class="review-card p-8 rounded-xl text-center">
                        <h2 class="text-3xl font-bold gradient-text mb-4">Basic</h2>
                        <p class="text-gray-400 text-lg mb-6">Free</p>
                        <ul class="text-left text-gray-300 space-y-3 mb-8">
                            <li class="flex items-center justify-center md:justify-start">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-green-400 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                                </svg>
                                <span>100 responses per day</span>
                            </li>
                            <li class="flex items-center justify-center md:justify-start">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-green-400 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                                </svg>
                                <span>Normal response speed</span>
                            </li>
                            <li class="flex items-center justify-center md:justify-start">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-green-400 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                                </svg>
                                <span>5 Notes Limit</span>
                            </li>
                        </ul>
                        <button class="w-full py-3 rounded-lg bg-gray-700 text-white font-bold hover:bg-gray-600 transition-all duration-300 cursor-not-allowed" disabled>
                            Current Plan
                        </button>
                    </div>

                    <!-- Pro Plan Card -->
                    <div class="review-card p-8 rounded-xl text-center border-2 border-purple-500">
                        <h2 class="text-3xl font-bold gradient-text mb-4">Profesional</h2>
                        <p class="text-gray-400 text-lg mb-6">$0<span class="text-sm text-gray-500">/month</span></p>
                        <ul class="text-left text-gray-300 space-y-3 mb-8">
                            <li class="flex items-center justify-center md:justify-start">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-green-400 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                                </svg>
                                <span>Unlimited responses</span>
                            </li>
                            <li class="flex items-center justify-center md:justify-start">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-green-400 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                                </svg>
                                <span>Prioritized response</span>
                            </li>
                            <li class="flex items-center justify-center md:justify-start">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-green-400 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                                </svg>
                                <span>Prompt Templates</span>
                            </li>
                            <li class="flex items-center justify-center md:justify-start">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-green-400 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                                </svg>
                                <span>Unlimited Notes</span>
                            </li>
                        </ul>
                        <button id="upgrade-pro-btn" onclick="attemptProUpgrade()" class="w-full py-3 rounded-lg bg-gradient-to-r from-purple-500 to-indigo-600 text-white font-bold hover:from-purple-600 hover:to-indigo-700 transition-all duration-300">
                            Upgrade to Profesional
                        </button>
                    </div>
                </div>

                <!-- Payment Options Modal (now used for token redemption) -->
                <div id="payment-modal" class="modal">
                    <div class="modal-content">
                        <button onclick="hidePaymentOptions()" class="modal-close-button">&times;</button>
                        <h2 class="text-2xl font-bold gradient-text mb-6 text-center">Upgrade to XLC Pro</h2>
                        <p class="text-center text-lg mb-4">Redeem 1,000 XLC Tokens to activate Pro Plan for 1 month.</p>
                        <div id="current-xlc-tokens" class="text-center text-xl font-bold mb-6">
                            You have 0 XLC Tokens
                        </div>
                        <button onclick="redeemXlcForPro()" class="modal-submit-button">Redeem 1,000 XLC</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notes Page -->
        <div id="notes" class="page p-4 md:p-8">
            <div class="max-w-6xl mx-auto h-full">
                <h1 class="text-3xl md:text-4xl font-bold mb-8 text-center gradient-text">Desk</h1>
                
                <div id="notes-content" class="notes-container">
                    <!-- Notes Sidebar -->
                    <div class="notes-sidebar custom-scrollbar">
                        <div class="notes-sidebar-header">
                            <h2 class="text-xl font-bold">Notes List</h2>
                            <button onclick="createNewNote()" class="p-2 rounded-full bg-gradient-to-r from-purple-00 to-indigo-600 hover:from-purple-600 hover:to-indigo-700 transition-all transform hover:scale-105">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                                </svg>
                            </button>
                        </div>
                        <div id="notes-list" class="notes-list custom-scrollbar">
                            <!-- Notes will be loaded here -->
                        </div>
                    </div>

                    <!-- Notes Editor -->
                    <div class="notes-editor">
                        <input type="text" id="note-title" class="notes-editor-title" placeholder="Note Title">
                        <textarea id="note-content" class="notes-editor-content custom-scrollbar" placeholder="Start writing your note here..."></textarea>
                        <div class="notes-editor-actions">
                            <button onclick="saveCurrentNote()" class="notes-editor-save-btn">Save Note</button>
                        </div>
                    </div>
                </div>

                <div id="notes-no-user-message" class="notes-no-user-message hidden">
                    <p class="text-lg text-gray-300">Please sign in to access notes.</p>
                </div>
            </div>
        </div>

        <!-- Removed Connect Page -->
        <!--
        <div id="connect" class="page p-4 md:p-8">
            <div class="max-w-6xl mx-auto">
                <h1 class="text-3xl md:text-4xl font-bold mb-8 text-center gradient-text">Connect with Others</h1>
                
                <div class="connect-container">
                    <div class="connect-section">
                        <h2>Community Groups</h2>
                        <div id="community-groups-list">
                        </div>
                        <button id="create-group-btn" onclick="showCreateGroupModal()" class="w-full py-2 rounded-lg bg-gradient-to-r from-purple-500 to-indigo-600 text-white font-bold mt-4">
                            Create New Group
                        </button>
                    </div>

                    <div class="connect-section">
                        <h2>Find Friends</h2>
                        <input type="text" id="find-friend-input" class="friend-search-input" placeholder="Search by username...">
                        <button id="find-friend-btn" onclick="findFriend()" class="w-full py-2 rounded-lg bg-gradient-to-r from-purple-500 to-indigo-600 text-white font-bold">
                            Search
                        </button>
                        <div id="friend-search-results" class="mt-4 space-y-2">
                        </div>
                    </div>

                    <div class="connect-section">
                        <h2>Your Chats</h2>
                        <button id="start-personal-chat-btn" onclick="showStartChatModal()" class="w-full py-2 rounded-lg bg-gradient-to-r from-purple-500 to-indigo-600 text-white font-bold mb-4">
                            Start New Personal Chat
                        </button>
                        <div id="user-chats-list" class="space-y-2">
                        </div>
                    </div>
                </div>
                <div id="connect-no-user-message" class="notes-no-user-message hidden">
                    <p class="text-lg text-gray-300">Please sign in to access community features.</p>
                </div>
            </div>
        </div>
        -->

        <!-- About Us Page -->
        <div id="about-us" class="page p-4 md:p-8">
            <div class="max-w-6xl mx-auto">
                <h1 class="text-3xl md:text-4xl font-bold mb-8 text-center gradient-text">About Xlence AI</h1>
                
                <div class="text-center text-lg text-gray-300 mb-12">
                    <p>Xlence AI is dedicated to empowering users with cutting-edge artificial intelligence solutions. We believe in creating smarter tools that enhance productivity, foster creativity, and connect communities.</p>
                </div>

                <div class="about-us-stats">
                    <div class="stat-card">
                        <h3>Total Accounts</h3>
                        <span class="number" id="accounts-count">0</span>
                    </div>
                    <div class="stat-card">
                        <h3>Average Transaction Rating</h3>
                        <span class="stars" id="transaction-rating"></span>
                    </div>
                    <div class="stat-card">
                        <h3>XLC Mined</h3>
                        <span class="number" id="xlc-mined-count">0</span>
                    </div>
                    <div class="stat-card">
                        <h3>Ecosystem Created</h3>
                        <span class="number" id="ecosystem-count">0</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Profile Page -->
        <div id="profile" class="page p-4 md:p-8">
            <div class="profile-container">
                <h1 class="text-3xl md:text-4xl font-bold mb-8 text-center gradient-text">Your Profile</h1>
                
                <div class="profile-avatar-wrapper" onclick="document.getElementById('pfp-upload').click()">
                    <img id="profile-pfp" class="profile-avatar" src="" alt="Profile Picture" src="https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/53c87aed-fabb-48c9-9ffd-29a410a45e30.png">
                    <span id="profile-pfp-placeholder" class="profile-avatar-placeholder"></span>
                    <input type="file" id="pfp-upload" accept="image/*" class="hidden">
                    <div class="profile-avatar-edit-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" />
                        </svg>
                    </div>
                </div>

                <div class="profile-input-group">
                    <label for="profile-name">Name:</label>
                    <input type="text" id="profile-name" class="profile-input" placeholder="Your Name">
                </div>

                <div class="profile-input-group">
                    <label for="profile-bio">Bio:</label>
                    <textarea id="profile-bio" class="profile-textarea" placeholder="Tell us about yourself..."></textarea>
                </div>

                <div class="profile-input-group">
                    <label>Status:</label>
                    <div class="profile-status-options">
                        <button id="status-active" class="profile-status-button profile-status-active" data-status="active">Active</button>
                        <button id="status-idle" class="profile-status-button profile-status-idle" data-status="idle">Idle</button>
                        <button id="status-dnd" class="profile-status-button profile-status-dnd" data-status="dnd">Do Not Disturb</button>
                    </div>
                </div>

                <button id="profile-save-button" class="profile-save-button">Save Profile</button>
            </div>
            <div id="profile-no-user-message" class="notes-no-user-message hidden">
                <p class="text-lg text-gray-300">Please sign in to access your profile.</p>
            </div>
        </div>

        <!-- Vault Page -->
        <div id="vault" class="page p-4 md:p-8">
            <div class="max-w-4xl mx-auto vault-container">
                <h1 class="text-3xl md:text-4xl font-bold mb-8 text-center gradient-text">VAULT</h1>
                
                <div class="planet-container" id="planet-container">
                    <div class="orbit-ring" data-direction="cw"></div>
                    <div class="orbit-ring" data-direction="ccw"></div>
                    <div class="orbit-ring" data-direction="cw"></div>
                    <div class="orbit-ring" data-direction="ccw"></div>
                    <div class="planet"></div>
                </div>

                <div id="xlc-token-display" class="text-2xl font-bold mb-4">
                    You have 0 XLC Tokens
                </div>
                <button id="simulate-ai-interaction-btn" class="py-2 px-4 rounded-lg bg-gradient-to-r from-purple-500 to-indigo-600 text-white font-bold hover:from-purple-600 hover:to-indigo-700 transition-all duration-300 mb-6">
                    Simulate AI Interaction
                </button>

                <div class="info-section text-lg text-gray-300 space-y-2">
                    <p>💡 XLC Token can be redeemed for model upgrade.</p>
                    <p>🚀 Holding Token Coming Soon: XLC will be tradable when listed</p>
                </div>
            </div>
            <div id="vault-no-user-message" class="notes-no-user-message hidden">
                <p class="text-lg text-gray-300">Please sign in to stack XLC Tokens.</p>
            </div>
        </div>
    </main>

    <!-- Auth Modal -->
    <div id="auth-modal" class="modal">
        <div class="modal-content">
            <button onclick="hideAuthModal()" class="modal-close-button">&times;</button>
            <h2 id="auth-modal-title" class="text-2xl font-bold gradient-text mb-6 text-center">Sign In</h2>
            
            <div id="signin-form">
                <input type="text" id="signin-username" class="modal-input" placeholder="Username">
                <input type="password" id="signin-seedphrase" class="modal-input" placeholder="Seed Phrase">
                <button onclick="signIn()" class="modal-submit-button">Sign In</button>
                <p class="modal-switch-text">Don't have an account? <span onclick="showAuthModal('signup')">Sign Up</span></p>
            </div>

            <div id="signup-form" class="hidden">
                <input type="text" id="signup-username" class="modal-input" placeholder="Username">
                <input type="text" id="signup-nickname" class="modal-input" placeholder="Nickname">
                <div class="seed-phrase-display" id="generated-seed-phrase"></div>
                <button onclick="generateSeedPhrase()" class="modal-submit-button mb-4">Generate Seed Phrase</button>
                <button onclick="signUp()" class="modal-submit-button">Sign Up</button>
                <p class="modal-switch-text">Already have an account? <span onclick="showAuthModal('signin')">Sign In</span></p>
            </div>
        </div>
    </div>

    <!-- Create Group Modal -->
    <div id="create-group-modal" class="modal">
        <div class="modal-content">
            <button onclick="hideCreateGroupModal()" class="modal-close-button">&times;</button>
            <h2 class="text-2xl font-bold gradient-text mb-6 text-center">Create New Group</h2>
            <input type="text" id="new-group-name" class="modal-input" placeholder="Group Name">
            <button onclick="createGroup()" class="modal-submit-button">Create Group</button>
        </div>
    </div>

    <!-- Start Personal Chat Modal -->
    <div id="start-chat-modal" class="modal">
        <div class="modal-content">
            <button onclick="hideStartChatModal()" class="modal-close-button">&times;</button>
            <h2 class="text-2xl font-bold gradient-text mb-6 text-center">Start New Personal Chat</h2>
            <input type="text" id="chat-partner-username" class="modal-input" placeholder="Enter friend's username">
            <button onclick="startPersonalChat()" class="modal-submit-button">Start Chat</button>
        </div>
    </div>

    <!-- Toast Notification Container -->
    <div id="toast-container" class="toast-notification">
        <span id="toast-message"></span>
    </div >

    <!-- Theme Switcher Button -->
    <button id="theme-switcher" class="theme-switcher">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h1M4 12H3m15.325 6.675l-.707.707M6.343 6.343l-.707-.707m12.728 0l-.707-.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
        </svg>
    </button>

    <script>
        // IMPORTANT: Replace with your actual Gemini API Key
        const GEMINI_API_KEY = "AIzaSyBkVuaLngxkMSluH84u-CgfU9YUauOPgbE"; 

        let currentPage = 'chat';
        let currentChatId = 1;
        let chatHistory = {}; // Stores chat history for the current session
        let chatCounter = 1;
        let dailyResponseCount = 0;
        const MAX_DAILY_RESPONSES = 100;
        const RESPONSE_LIMIT_KEY = 'ai_response_count';
        const LAST_RESPONSE_DATE_KEY = 'ai_last_response_date';
        const CHAT_HISTORY_KEY = 'chat_history'; // Generic key for chat history
        const USER_NOTES_KEY = 'user_notes'; // Generic key for notes
        const USER_PROFILE_KEY = 'user_profile'; // Generic key for profile
        const ACCOUNTS_KEY = 'user_accounts'; // Key for storing user accounts
        const CURRENT_USER_KEY = 'current_user'; // Key for storing current logged-in user
        const XLC_TOKENS_KEY = 'xlc_tokens'; // Key for XLC tokens
        const AI_INTERACTIONS_KEY = 'ai_interactions'; // Key for AI interactions
        const PRO_PLAN_ACTIVE_KEY = 'pro_plan_active'; // Key for Pro Plan status
        const PRO_PLAN_EXPIRY_KEY = 'pro_plan_expiry'; // Key for Pro Plan expiry date

        let userNotes = {}; // Stores notes for the current session
        let currentNoteId = null; // ID of the currently active note in the editor
        let currentUser = null; // Stores the currently logged-in user object
        let isProPlanActive = false; // Tracks Pro Plan status

        // Notes limit (now applies universally)
        const BASIC_PLAN_NOTES_LIMIT = 5;
        const PRO_PLAN_TOKEN_COST = 1000; // Cost to activate Pro Plan

        // --- Theme Switcher Logic ---
        function toggleTheme() {
            document.body.classList.toggle('light-mode');
            // Save user preference to localStorage
            if (document.body.classList.contains('light-mode')) {
                localStorage.setItem('theme', 'light');
            } else {
                localStorage.setItem('theme', 'dark');
            }
        }

        // Apply saved theme on page load
        document.addEventListener('DOMContentLoaded', () => {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'light') {
                document.body.classList.add('light-mode');
            }
            // Add event listener for the theme switcher button
            document.getElementById('theme-switcher').addEventListener('click', toggleTheme);
        });

        // --- Toast Notification Functions ---
        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast-container');
            const toastMessage = document.getElementById('toast-message');

            toastMessage.textContent = message;
            toast.className = 'toast-notification show'; // Reset classes
            if (type === 'success') {
                toast.classList.add('success');
            } else if (type === 'error') {
                toast.classList.add('error');
            }

            setTimeout(() => {
                toast.classList.remove('show', 'success', 'error');
            }, 3000); // Hide after 3 seconds
        }

        // --- AI Response Limit Logic ---
        function initializeResponseLimit() {
            const today = new Date().toDateString();
            const lastResponseDate = localStorage.getItem(LAST_RESPONSE_DATE_KEY);

            if (lastResponseDate !== today) {
                // New day, reset count
                dailyResponseCount = 0;
                localStorage.setItem(RESPONSE_LIMIT_KEY, 0);
                localStorage.setItem(LAST_RESPONSE_DATE_KEY, today);
            } else {
                dailyResponseCount = parseInt(localStorage.getItem(RESPONSE_LIMIT_KEY) || '0', 10);
            }
            checkAndDisplayResponseLimit();
        }

        function incrementResponseCount() {
            dailyResponseCount++;
            localStorage.setItem(RESPONSE_LIMIT_KEY, dailyResponseCount);
            localStorage.setItem(LAST_RESPONSE_DATE_KEY, new Date().toDateString());
            checkAndDisplayResponseLimit();
        }

        // --- XLC Token Logic ---
        function getXlcTokens() {
            if (!currentUser) return 0;
            const userXlcData = JSON.parse(localStorage.getItem(XLC_TOKENS_KEY) || '{}');
            return userXlcData[currentUser.username] || 0;
        }

        function setXlcTokens(tokens) {
            if (!currentUser) return;
            let userXlcData = JSON.parse(localStorage.getItem(XLC_TOKENS_KEY) || '{}');
            userXlcData[currentUser.username] = tokens;
            localStorage.setItem(XLC_TOKENS_KEY, JSON.stringify(userXlcData));
            updateXlcDisplay();
        }

        function getAiInteractions() {
            if (!currentUser) return 0;
            const userInteractionsData = JSON.parse(localStorage.getItem(AI_INTERACTIONS_KEY) || '{}');
            return userInteractionsData[currentUser.username] || 0;
        }

        function setAiInteractions(interactions) {
            if (!currentUser) return;
            let userInteractionsData = JSON.parse(localStorage.getItem(AI_INTERACTIONS_KEY) || '{}');
            userInteractionsData[currentUser.username] = interactions;
            localStorage.setItem(AI_INTERACTIONS_KEY, JSON.stringify(userInteractionsData));
        }

        function updateXlcDisplay() {
            const xlcDisplay = document.getElementById('xlc-token-display');
            const modalXlcDisplay = document.getElementById('current-xlc-tokens');
            if (xlcDisplay) {
                xlcDisplay.textContent = `You have ${getXlcTokens()} XLC Tokens`;
            }
            if (modalXlcDisplay) {
                modalXlcDisplay.textContent = `You have ${getXlcTokens()} XLC Tokens`;
            }
        }

        function simulateAiInteraction() {
            if (!currentUser) {
                showToast('Please sign in to simulate AI interactions and stack XLC Tokens.', 'error');
                return;
            }

            let interactions = getAiInteractions();
            interactions++;
            setAiInteractions(interactions);

            if (interactions % 5 === 0) {
                let currentTokens = getXlcTokens();
                currentTokens++;
                setXlcTokens(currentTokens);
                showToast('You earned 1 XLC Token!', 'success');
            } else {
                showToast(`Simulated AI interaction. ${5 - (interactions % 5)} more for 1 XLC.`, 'info');
            }
        }

        function checkAndDisplayResponseLimit() {
            const limitMessage = document.getElementById('response-limit-message');
            const userInput = document.getElementById('user-input');
            const sendBtn = document.getElementById('send-btn');

            if (isProPlanActive) {
                limitMessage.classList.add('hidden');
                userInput.disabled = false;
                sendBtn.disabled = false;
                return;
            }

            if (dailyResponseCount >= MAX_DAILY_RESPONSES) {
                limitMessage.classList.remove('hidden');
                userInput.disabled = true;
                sendBtn.disabled = true;
            } else {
                limitMessage.classList.add('hidden');
                userInput.disabled = false;
                sendBtn.disabled = false;
            }
        }

        // --- Pro Plan Logic ---
        function checkProPlanStatus() {
            if (!currentUser) {
                isProPlanActive = false;
                return;
            }

            const proPlanData = JSON.parse(localStorage.getItem(PRO_PLAN_ACTIVE_KEY) || '{}');
            const expiryDateStr = proPlanData[currentUser.username];

            if (expiryDateStr) {
                const expiryDate = new Date(expiryDateStr);
                if (new Date() < expiryDate) {
                    isProPlanActive = true;
                } else {
                    isProPlanActive = false;
                    // Optionally remove expired status
                    delete proPlanData[currentUser.username];
                    localStorage.setItem(PRO_PLAN_ACTIVE_KEY, JSON.stringify(proPlanData));
                    showToast('Your Pro Plan has expired.', 'info');
                }
            } else {
                isProPlanActive = false;
            }
            updatePricingPageUI();
            checkAndDisplayResponseLimit(); // Update chat input based on pro status
        }

        function activateProPlan() {
            if (!currentUser) {
                showToast('Please sign in to activate Pro Plan.', 'error');
                return;
            }

            const expiryDate = new Date();
            expiryDate.setMonth(expiryDate.getMonth() + 1); // 1 month from now

            let proPlanData = JSON.parse(localStorage.getItem(PRO_PLAN_ACTIVE_KEY) || '{}');
            proPlanData[currentUser.username] = expiryDate.toISOString();
            localStorage.setItem(PRO_PLAN_ACTIVE_KEY, JSON.stringify(proPlanData));

            isProPlanActive = true;
            showToast('Pro Plan activated successfully for 1 month!', 'success');
            hidePaymentOptions();
            updatePricingPageUI();
            checkAndDisplayResponseLimit(); // Update chat input
        }

        function attemptProUpgrade() {
            if (!currentUser) {
                showToast('Please sign in to upgrade to Pro Plan.', 'error');
                showAuthModal('signin');
                return;
            }

            if (isProPlanActive) {
                showToast('You already have an active Pro Plan!', 'info');
                return;
            }

            updateXlcDisplay(); // Update token count in modal
            showPaymentOptions();
        }

        function redeemXlcForPro() {
            if (!currentUser) {
                showToast('Please sign in to redeem tokens.', 'error');
                return;
            }

            const currentTokens = getXlcTokens();
            if (currentTokens >= PRO_PLAN_TOKEN_COST) {
                setXlcTokens(currentTokens - PRO_PLAN_TOKEN_COST);
                activateProPlan();
            } else {
                showToast(`Insufficient XLC Tokens. You need ${PRO_PLAN_TOKEN_COST} XLC. You have ${currentTokens}.`, 'error');
            }
        }

        function updatePricingPageUI() {
            const basicPlanBtn = document.querySelector('#pricing .review-card:first-child button');
            const proPlanBtn = document.querySelector('#pricing .review-card:last-child button');

            if (isProPlanActive) {
                basicPlanBtn.textContent = 'Basic Plan (Inactive)';
                basicPlanBtn.classList.add('cursor-not-allowed', 'bg-gray-700', 'text-white');
                basicPlanBtn.classList.remove('bg-gradient-to-r', 'from-purple-500', 'to-indigo-600', 'hover:from-purple-600', 'hover:to-indigo-700');
                basicPlanBtn.disabled = true;

                proPlanBtn.textContent = 'Pro Plan Active';
                proPlanBtn.classList.add('cursor-not-allowed');
                proPlanBtn.classList.remove('hover:from-purple-600', 'hover:to-indigo-700');
                proPlanBtn.disabled = true;
            } else {
                basicPlanBtn.textContent = 'Current Plan';
                basicPlanBtn.classList.add('cursor-not-allowed', 'bg-gray-700', 'text-white');
                basicPlanBtn.classList.remove('bg-gradient-to-r', 'from-purple-500', 'to-indigo-600', 'hover:from-purple-600', 'hover:to-indigo-700');
                basicPlanBtn.disabled = true;

                proPlanBtn.textContent = 'Upgrade to Pro';
                proPlanBtn.classList.remove('cursor-not-allowed');
                proPlanBtn.classList.add('bg-gradient-to-r', 'from-purple-500', 'to-indigo-600', 'hover:from-purple-600', 'hover:to-indigo-700');
                proPlanBtn.disabled = false;
            }
        }


        // --- Chat Greeting Logic ---
        function updateChatGreeting() {
            const greetings = [
                `Hey ${currentUser ? currentUser.nickname : 'there'}!`,
                `How are you ${currentUser ? currentUser.nickname : 'doing'}?`
            ];
            const randomGreeting = greetings[Math.floor(Math.random() * greetings.length)];
            document.getElementById('chat-greeting').textContent = randomGreeting;
        }

        // --- Existing Functions ---
        function switchPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // Remove active class from all sidebar nav items
            document.querySelectorAll('.sidebar-nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Show selected page
            document.getElementById(pageId).classList.add('active');
            
            // Add active class to clicked sidebar nav item
            const sidebarNavItem = document.querySelector(`#sidebar button[onclick="switchPage('${pageId}')"]`);
            if (sidebarNavItem) {
                sidebarNavItem.classList.add('active');
            }
            
            currentPage = pageId;
            
            // Animate team members when about page is shown
            if (pageId === 'about') {
                setTimeout(() => {
                    document.querySelectorAll('.team-member').forEach((member, index) => {
                        setTimeout(() => {
                            member.classList.add('visible');
                        }, index * 200);
                    });
                }, 100);
            }

            // Update notes UI when switching to notes page
            if (pageId === 'notes') {
                updateNotesUI();
            }

            // Trigger count animations when about-us page is shown
            if (pageId === 'about-us') {
                animateCounts();
            }

            // Update profile UI when switching to profile page
            if (pageId === 'profile') {
                updateProfileUI();
            }

            // Update vault UI when switching to vault page
            if (pageId === 'vault') {
                updateVaultUI();
                startOrbitAnimations(); // Start animations when vault page is active
            } else {
                stopOrbitAnimations(); // Stop animations when leaving vault page
            }

            // Update pricing UI when switching to pricing page
            if (pageId === 'pricing') {
                updatePricingPageUI();
            }

            // Close sidebar after selection (for all screen sizes)
            closeSidebar();
        }
        
        function toggleChatDropdown() {
            const dropdown = document.getElementById('chat-dropdown');
            const arrow = document.getElementById('dropdown-arrow');
            const isVisible = dropdown.classList.contains('opacity-100');
            
            if (isVisible) {
                dropdown.classList.remove('opacity-100', 'visible', 'scale-100');
                dropdown.classList.add('opacity-0', 'invisible', 'scale-95');
                arrow.style.transform = 'rotate(0deg)';
            } else {
                dropdown.classList.remove('opacity-0', 'invisible', 'scale-100');
                dropdown.classList.add('opacity-100', 'visible', 'scale-100');
                arrow.style.transform = 'rotate(180deg)';
                updateChatHistoryList();
            }
        }
        
        function startNewChat() {
            // Save current chat before creating a new one
            saveChatHistory();
            
            // Create new chat
            chatCounter++;
            currentChatId = Date.now(); // Use timestamp as unique ID
            chatHistory[currentChatId] = {
                id: currentChatId,
                title: `Chat ${chatCounter}`,
                messages: [
                    {
                        content: "Hello! How can I help you today?",
                        isUser: false,
                        timestamp: new Date()
                    }
                ],
                created: new Date()
                };
            
            // Clear and reload messages
            loadChatMessages();
            toggleChatDropdown();
            showPromptTemplates(); // Show templates when starting a new chat
        }
        
        function loadChat(chatId) {
            // Save current chat before switching
            saveChatHistory();
            
            // Switch to selected chat
            currentChatId = chatId;
            loadChatMessages();
            toggleChatDropdown();
            hidePromptTemplates(); // Hide templates when loading an existing chat
        }
        
        function saveChatHistory() {
            const messagesContainer = document.getElementById('chat-messages');
            const messages = [];
            
            messagesContainer.querySelectorAll('.message').forEach(messageEl => {
                const isUser = messageEl.classList.contains('user-message');
                // Extract content, preserving HTML for formatting
                const content = messageEl.querySelector('p').innerHTML; 
                messages.push({
                    content: content,
                    isUser: isUser,
                    timestamp: new Date()
                });
            });
            
            if (chatHistory[currentChatId]) {
                chatHistory[currentChatId].messages = messages;
                
                // Update title based on first user message (use textContent for title)
                const firstUserMessage = messages.find(m => m.isUser);
                if (firstUserMessage) {
                    const tempDiv = document.createElement('div');
                    tempDiv.innerHTML = firstUserMessage.content;
                    const titleText = tempDiv.textContent || tempDiv.innerText || '';

                    const title = titleText.length > 30 
                        ? titleText.substring(0, 30) + ''
                        : titleText;
                    chatHistory[currentChatId].title = title;
                }
            }
            localStorage.setItem(CHAT_HISTORY_KEY, JSON.stringify(chatHistory));
        }
        
        function loadChatMessages() {
            const messagesContainer = document.getElementById('chat-messages');
            messagesContainer.innerHTML = '';
            
            if (chatHistory[currentChatId]) {
                chatHistory[currentChatId].messages.forEach(message => {
                    addMessageToDOM(message.content, message.isUser);
                });
            }
            messagesContainer.scrollTop = messagesContainer.scrollHeight; // Scroll to bottom after loading

            // Hide prompt templates if there are user messages in the current chat
            const hasUserMessages = chatHistory[currentChatId].messages.some(msg => msg.isUser);
            if (hasUserMessages) {
                hidePromptTemplates();
            } else {
                showPromptTemplates();
            }
        }
        
        function updateChatHistoryList() {
            const historyList = document.getElementById('chat-history-list');
            historyList.innerHTML = '';
            
            // Sort chats by creation date (newest first)
            const sortedChats = Object.values(chatHistory).sort((a, b) => new Date(b.created) - new Date(a.created));
            
            if (sortedChats.length === 0) {
                historyList.innerHTML = '<div class="px-3 py-2 text-sm text-gray-500">No chat history</div>';
                return;
            }
            
            sortedChats.forEach(chat => {
                const chatItem = document.createElement('button');
                chatItem.className = `w-full flex items-start space-x-3 px-3 py-2 text-left hover:bg-gray-700 rounded-lg transition-all duration-200 ${chat.id === currentChatId ? 'bg-gray-700' : ''}`;
                chatItem.onclick = () => loadChat(chat.id);
                
                const timeAgo = getTimeAgo(chat.created);
                
                chatItem.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mt-1 text-gray-400 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
                    </svg>
                    <div class="flex-1 min-w-0">
                        <div class="text-sm font-medium text-white truncate">${chat.title}</div>
                        <div class="text-xs text-gray-400">${timeAgo}</div>
                    </div>
                    ${chat.id === currentChatId ? `
                        <div class="w-2 h-2 bg-green-400 rounded-full flex-shrink-0"></div>
                    ` : ''}
                `;
                
                historyList.appendChild(chatItem);
            });
        }
        
        function clearChatHistory() {
            if (confirm('Are you sure you want to clear all chat history? This action cannot be undone.')) {
                chatHistory = {};
                startNewChat(); // This will create a new chat and effectively clear the current view
                localStorage.removeItem(CHAT_HISTORY_KEY); // Also clear from storage
                updateChatHistoryList();
            }
        }
        
        function getTimeAgo(date) {
            const now = new Date();
            const diffInMinutes = Math.floor((now - new Date(date)) / (1000 * 60));
            
            if (diffInMinutes < 1) return 'Just now';
            if (diffInMinutes < 60) return `${diffInMinutes}m ago`;
            
            const diffInHours = Math.floor(diffInMinutes / 60);
            if (diffInHours < 24) return `${diffInHours}h ago`;
            
            const diffInDays = Math.floor(diffInHours / 24);
            if (diffInDays < 7) return `${diffInDays}d ago`;
            
            return new Date(date).toLocaleDateString();
        }
        
        function addMessage(content, isUser = false) {
            // Save message to current chat
            if (!chatHistory[currentChatId]) {
                chatHistory[currentChatId] = {
                    id: currentChatId,
                    title: isUser ? (content.length > 30 ? content.substring(0, 30) + '' : content) : `Chat ${chatCounter}`,
                    messages: [],
                    created: new Date()
                };
            }
            
            // Only add user messages to history here. AI messages are added after typing animation.
            if (isUser) {
                chatHistory[currentChatId].messages.push({
                    content: content,
                    isUser: isUser,
                    timestamp: new Date()
                });
            }
            
            // Update title if this is the first user message
            if (isUser && chatHistory[currentChatId].messages.filter(m => m.isUser).length === 1) {
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = content;
                const titleText = tempDiv.textContent || tempDiv.innerText || '';

                chatHistory[currentChatId].title = titleText.length > 30 ? titleText.substring(0, 30) + '' : titleText;
            }
            
            addMessageToDOM(content, isUser);
        }
        
        function addMessageToDOM(content, isUser = false) {
            const messagesContainer = document.getElementById('chat-messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = isUser ? 'user-message message' : 'ai-message message';
            
            if (isUser) {
                // Removed "You" text
                messageDiv.innerHTML = `<div class="font-medium mb-1"></div><p>${content}</p>`;
            } else {
                // Removed "Xlence AI" text
                messageDiv.innerHTML = `<div class="font-medium mb-1 gradient-text"></div><p>${formatAIResponse(content)}</p>`;
            }
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        // Function to format AI response for display
        function formatAIResponse(text) {
            // Replace **text** with <strong>text</strong>
            text = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            
            // Replace * text with <ul><li> text (simple bullet points)
            // This is a basic implementation and might need more robust parsing for complex markdown lists
            text = text.replace(/^\s*\*\s*(.*)/gm, '<li>$1</li>');
            if (text.includes('<li>')) {
                text = `<ul>${text}</ul>`;
            }

            // Replace 1. text with <ol><li> text (simple numbered lists)
            text = text.replace(/^\s*\d+\.\s*(.*)/gm, '<li>$1</li>');
            if (text.includes('<li>') && !text.startsWith('<ul>')) { // Avoid nesting if already a bullet list
                text = `<ol>${text}</ol>`;
            }

            // Handle newlines for paragraphs if not part of a list
            if (!text.startsWith('<ul') && !text.startsWith('<ol')) {
                text = text.replace(/\n/g, '<br>');
            }
            
            return text;
        }
        
        function showTypingIndicator() {
            const messagesContainer = document.getElementById('chat-messages');
            const typingDiv = document.createElement('div');
            typingDiv.className = 'typing-indicator';
            typingDiv.id = 'typing-indicator';
            // Removed "Xlence AI" text
            typingDiv.innerHTML = `
                <div class="font-medium mb-1 gradient-text"></div>
                <div class="flex space-x-1">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
            `;
            messagesContainer.appendChild(typingDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }
        
        function removeTypingIndicator() {
            const typingIndicator = document.getElementById('typing-indicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }

        // Function to simulate typing out the AI response letter by letter
        function typeMessage(htmlContent, callback) { // Now accepts HTML content
            const messagesContainer = document.getElementById('chat-messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'ai-message message';
            // Removed "Xlence AI" text
            messageDiv.innerHTML = `<div class="font-medium mb-1 gradient-text"></div><p></p>`;
            messagesContainer.appendChild(messageDiv);

            const paragraph = messageDiv.querySelector('p');
            let i = 0;
            const speed = 20; // Typing speed in milliseconds per character

            // Create a temporary div to parse the HTML content
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = htmlContent;
            const nodes = Array.from(tempDiv.childNodes); // Get all child nodes (text, strong, ul, li, br)

            function typeNode(nodeIndex, charIndex) {
                if (nodeIndex < nodes.length) {
                    const currentNode = nodes[nodeIndex];

                    if (currentNode.nodeType === Node.TEXT_NODE) { // Text node
                        if (charIndex < currentNode.textContent.length) {
                            paragraph.innerHTML += currentNode.textContent.charAt(charIndex);
                            messagesContainer.scrollTop = messagesContainer.scrollHeight;
                            setTimeout(() => typeNode(nodeIndex, charIndex + 1), speed);
                        } else {
                            // Move to next node
                            typeNode(nodeIndex + 1, 0);
                        }
                    } else if (currentNode.nodeType === Node.ELEMENT_NODE) { // Element node (e.g., strong, ul, li, br)
                        // Append the entire element's outerHTML
                        paragraph.innerHTML += currentNode.outerHTML;
                        messagesContainer.scrollTop = messagesContainer.scrollHeight;
                        // Move to next node
                        typeNode(nodeIndex + 1, 0);
                    } else {
                        // Skip other node types (comments, etc.)
                        typeNode(nodeIndex + 1, 0);
                    }
                } else {
                    // All nodes typed, call the callback
                    if (callback) {
                        callback();
                    }
                }
            }
            typeNode(0, 0); // Start typing from the first node
        }
        
 // Function to call Gemini API
 async function getGeminiResponse(userMessage) {
    const conversation = chatHistory[currentChatId].messages.map(msg => ({
        role: msg.isUser ? 'user' : 'model',
        parts: [{ text: msg.content }]
    }));

    // Add the latest user message to the conversation
    conversation.push({ role: 'user', parts: [{ text: userMessage }] });

    // CORRECT GEMINI API ENDPOINT (replace with the actual one if different)
    // This is a common endpoint structure for Google's Generative AI APIs
    const GEMINI_API_ENDPOINT = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${GEMINI_API_KEY}`;

    try {
        const response = await fetch(GEMINI_API_ENDPOINT, { // Use the correct API endpoint here
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                contents: conversation // Gemini API expects 'contents' for the conversation history
            })
        });

        if (!response.ok) {
            const errorData = await response.json();
            throw new Error(`API error: ${response.status} ${response.statusText} - ${errorData.error.message}`);
        }

        const data = await response.json();
        // The response structure for Gemini API might be different.
        // You'll likely find the generated text in data.candidates[0].content.parts[0].text
        if (data.candidates && data.candidates.length > 0 && data.candidates[0].content && data.candidates[0].content.parts && data.candidates[0].content.parts.length > 0) {
            return data.candidates[0].content.parts[0].text;
        } else {
            return "No response generated by AI.";
        }
    } catch (error) {
        console.error("Error calling backend Gemini API:", error);
        return `Error: ${error.message}. Please check backend connection or API key.`;
    }
}


       
        async function sendMessage() {
            const input = document.getElementById('user-input');
            const userMessage = input.value.trim();
            
            if (!userMessage) return; // Don't send empty messages

            // Check response limit before sending message
            if (!isProPlanActive && dailyResponseCount >= MAX_DAILY_RESPONSES) {
                checkAndDisplayResponseLimit(); // Ensure message is shown
                return;
            }
            
            addMessage(userMessage, true);
            input.value = '';
            
            // Hide prompt templates after the first user message
            hidePromptTemplates();

            // Disable send button and input field
            document.getElementById('send-btn').disabled = true;
            document.getElementById('user-input').disabled = true;

            // Show typing indicator
            showTypingIndicator();
            
            try {
                const aiResponse = await getGeminiResponse(userMessage);
                removeTypingIndicator(); // Remove indicator before starting typing animation

                // Format the AI response to HTML BEFORE passing it to typeMessage
                const formattedAiResponse = formatAIResponse(aiResponse);

                // Use the new typeMessage function for animated typing
                typeMessage(formattedAiResponse, () => {
                    // This callback runs when the typing animation is complete
                    // Add the full message to chatHistory after typing is done
                    if (!chatHistory[currentChatId]) {
                        chatHistory[currentChatId] = {
                            id: currentChatId,
                            title: userMessage.length > 30 ? userMessage.substring(0, 30) + '' : userMessage,
                            messages: [],
                            created: new Date()
                        };
                    }
                    chatHistory[currentChatId].messages.push({
                        content: aiResponse, // Store original AI response for history/re-formatting
                        isUser: false,
                        timestamp: new Date()
                    });

                    if (!isProPlanActive) { // Only increment if not Pro Plan
                        incrementResponseCount(); // Increment count after AI responds
                    }
                    saveChatHistory(); // Save chat history after each message

                    // Re-enable send button and input field
                    document.getElementById('send-btn').disabled = false;
                    document.getElementById('user-input').disabled = false;
                    document.getElementById('user-input').focus(); // Focus back on input
                });

            } catch (error) {
                console.error("Failed to get AI response:", error);
                removeTypingIndicator();
                addMessage("Oops! Something went wrong while getting a response from the AI. Please try again later.", false);

                // Re-enable send button and input field even on error
                document.getElementById('send-btn').disabled = false;
                document.getElementById('user-input').disabled = false;
                document.getElementById('user-input').focus();
            }
        }
        
        // Event listeners
        document.getElementById('send-btn').addEventListener('click', sendMessage);
        document.getElementById('user-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
        
        // Chat dropdown event listener
        document.getElementById('chat-dropdown-btn').addEventListener('click', toggleChatDropdown);
        
        // Close dropdown when clicking outside
        document.addEventListener('click', function(e) {
            const dropdown = document.getElementById('chat-dropdown');
            const dropdownBtn = document.getElementById('chat-dropdown-btn');
            
            if (!dropdown.contains(e.target) && !dropdownBtn.contains(e.target)) {
                dropdown.classList.remove('opacity-100', 'visible', 'scale-100');
                dropdown.classList.add('opacity-0', 'invisible', 'scale-95');
                document.getElementById('dropdown-arrow').style.transform = 'rotate(0deg)';
            }

            // Close sidebar when clicking outside if it's open
            const sidebar = document.getElementById('sidebar');
            const sidebarToggle = document.getElementById('sidebar-toggle');
            if (sidebar.classList.contains('open') && !sidebar.contains(e.target) && !sidebarToggle.contains(e.target)) {
                closeSidebar();
            }
        });

        // Prompt Templates Logic
        function showPromptTemplates() {
            document.getElementById('prompt-templates').classList.remove('hidden');
        }

        function hidePromptTemplates() {
            document.getElementById('prompt-templates').classList.add('hidden');
        }

        // Add event listeners for prompt templates
        document.querySelectorAll('.prompt-template-btn').forEach(button => {
            button.addEventListener('click', function() {
                document.getElementById('user-input').value = this.textContent.trim();
                sendMessage();
            });
        });

        // Payment Modal Functions
        function showPaymentOptions() {
            document.getElementById('payment-modal').classList.add('show');
        }

        function hidePaymentOptions() {
            document.getElementById('payment-modal').classList.remove('show');
        }

        // --- Notes Specific Functions ---
        function updateNotesUI() {
            const notesContent = document.getElementById('notes-content');
            const noUserMessage = document.getElementById('notes-no-user-message');
            const noteTitleInput = document.getElementById('note-title');
            const noteContentInput = document.getElementById('note-content');

            if (currentUser) {
                notesContent.classList.remove('hidden');
                noUserMessage.classList.add('hidden');
                loadNotesList(); // Load notes for the current user
                // Clear editor when notes page is opened
                noteTitleInput.value = '';
                noteContentInput.value = '';
                currentNoteId = null;
            } else {
                notesContent.classList.remove('hidden'); // Keep notes content visible
                noUserMessage.classList.remove('hidden'); // Show message
                // Disable editing for non-signed-in users
                noteTitleInput.disabled = true;
                noteContentInput.disabled = true;
                document.querySelector('.notes-editor-save-btn').disabled = true;
                document.querySelector('.notes-sidebar-header button').disabled = true; // Disable new note button
                notesContent.classList.add('pointer-events-none', 'opacity-50'); // Visually disable
            }
        }

        function saveUserNotes() {
            if (currentUser) {
                let allNotes = JSON.parse(localStorage.getItem(USER_NOTES_KEY) || '{}');
                allNotes[currentUser.username] = userNotes;
                localStorage.setItem(USER_NOTES_KEY, JSON.stringify(allNotes));
            }
        }

        function loadUserNotes() {
            if (currentUser) {
                const allNotes = JSON.parse(localStorage.getItem(USER_NOTES_KEY) || '{}');
                userNotes = allNotes[currentUser.username] || {};
            } else {
                userNotes = {}; // Clear notes if no user is logged in
            }
            loadNotesList(); // Update the sidebar list
        }

        function loadNotesList() {
            const notesListDiv = document.getElementById('notes-list');
            notesListDiv.innerHTML = ''; // Clear existing list

            if (!currentUser) {
                notesListDiv.innerHTML = '<p class="text-gray-500 text-center mt-4">Sign in to see your notes.</p>';
                return;
            }

            const sortedNoteIds = Object.keys(userNotes).sort((a, b) => {
                return new Date(userNotes[b].lastModified) - new Date(userNotes[a].lastModified);
            });

            if (sortedNoteIds.length === 0) {
                notesListDiv.innerHTML = '<p class="text-gray-500 text-center mt-4">No notes yet. Click "+" to create one!</p>';
                return;
            }

            sortedNoteIds.forEach(noteId => {
                const note = userNotes[noteId];
                const listItem = document.createElement('div');
                listItem.className = `notes-list-item ${noteId === currentNoteId ? 'active' : ''}`;
                listItem.setAttribute('data-note-id', noteId);
                listItem.innerHTML = `
                    <span class="notes-list-item-title">${note.title || 'Untitled Note'}</span>
                    <button class="notes-delete-btn" onclick="deleteNote(event, '${noteId}')">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                        </svg>
                    </button>
                `;
                listItem.onclick = (event) => {
                    // Only load note if click is not on delete button
                    if (!event.target.closest('.notes-delete-btn')) {
                        loadNote(noteId);
                    }
                };
                notesListDiv.appendChild(listItem);
            });
        }

        function createNewNote() {
            if (!currentUser) {
                showToast('Please sign in to create notes.', 'error');
                return;
            }
            // Check notes limit
            if (!isProPlanActive && Object.keys(userNotes).length >= BASIC_PLAN_NOTES_LIMIT) {
                showToast(`You have reached the limit of ${BASIC_PLAN_NOTES_LIMIT} notes for Basic Plan. Upgrade to Pro for unlimited notes.`, 'error');
                return;
            }

            // Save current note if one is active
            if (currentNoteId) {
                saveCurrentNote();
            }

            const newNoteId = Date.now().toString();
            userNotes[newNoteId] = {
                id: newNoteId,
                title: 'Untitled Note',
                content: '',
                createdAt: new Date().toISOString(),
                lastModified: new Date().toISOString()
            };
            currentNoteId = newNoteId;
            document.getElementById('note-title').value = userNotes[newNoteId].title;
            document.getElementById('note-content').value = userNotes[newNoteId].content;
            
            saveUserNotes();
            loadNotesList(); // Refresh list to show new note
        }

        function loadNote(noteId) {
            if (!currentUser) {
                showToast('Please sign in to access notes.', 'error');
                return;
            }
            // Save current note before loading a new one
            if (currentNoteId && currentNoteId !== noteId) {
                saveCurrentNote();
            }

            const note = userNotes[noteId];
            if (note) {
                currentNoteId = noteId;
                document.getElementById('note-title').value = note.title;
                document.getElementById('note-content').value = note.content;
                loadNotesList(); // Update active state in list
            } else {
                showToast('Note not found!', 'error');
            }
        }

        function saveCurrentNote() {
            if (!currentUser) {
                showToast('Please sign in to save notes.', 'error');
                return;
            }
            if (!currentNoteId) {
                showToast('No note selected to save.', 'info');
                return;
            }

            const title = document.getElementById('note-title').value.trim();
            const content = document.getElementById('note-content').value;

            if (userNotes[currentNoteId]) {
                userNotes[currentNoteId].title = title || 'Untitled Note';
                userNotes[currentNoteId].content = content;
                userNotes[currentNoteId].lastModified = new Date().toISOString();
                saveUserNotes();
                loadNotesList(); // Refresh list to update title/last modified
                showToast('Note saved!', 'success');
            } else {
                showToast('Error: Cannot save note. It might have been deleted.', 'error');
            }
        }

        function deleteNote(event, noteId) {
            if (!currentUser) {
                showToast('Please sign in to delete notes.', 'error');
                return;
            }
            event.stopPropagation(); // Prevent triggering loadNote
            if (confirm('Are you sure you want to delete this note?')) {
                if (userNotes[noteId]) {
                    delete userNotes[noteId];
                    saveUserNotes();

                    if (currentNoteId === noteId) {
                        // If the deleted note was open, clear the editor
                        document.getElementById('note-title').value = '';
                        document.getElementById('note-content').value = '';
                        currentNoteId = null;
                    }
                    loadNotesList(); // Refresh the list
                } else {
                    showToast('Note not found for deletion.', 'error');
                }
            }
        }

        // --- Profile Page Functions ---
        function updateProfileUI() {
            const profileContent = document.querySelector('#profile .profile-container');
            const noUserMessage = document.getElementById('profile-no-user-message');
            const profileNameInput = document.getElementById('profile-name');
            const profileBioTextarea = document.getElementById('profile-bio');
            const profileSaveButton = document.getElementById('profile-save-button');
            const profileStatusButtons = document.querySelectorAll('.profile-status-button');
            const pfpUploadInput = document.getElementById('pfp-upload');
            const profileAvatarWrapper = document.querySelector('.profile-avatar-wrapper');


            if (currentUser) {
                profileContent.classList.remove('hidden');
                noUserMessage.classList.add('hidden');
                loadUserProfile();
                profileNameInput.disabled = false;
                profileBioTextarea.disabled = false;
                profileSaveButton.disabled = false;
                pfpUploadInput.disabled = false;
                profileAvatarWrapper.classList.remove('pointer-events-none', 'opacity-50');
                profileStatusButtons.forEach(btn => btn.disabled = false);
            } else {
                profileContent.classList.remove('hidden'); // Keep profile content visible
                noUserMessage.classList.remove('hidden'); // Show message
                // Disable editing for non-signed-in users
                profileNameInput.disabled = true;
                profileBioTextarea.disabled = true;
                profileSaveButton.disabled = true;
                pfpUploadInput.disabled = true;
                profileAvatarWrapper.classList.add('pointer-events-none', 'opacity-50'); // Visually disable
                profileStatusButtons.forEach(btn => btn.disabled = true);
            }
        }

        function loadUserProfile() {
            if (!currentUser) return;

            let allProfiles = JSON.parse(localStorage.getItem(USER_PROFILE_KEY) || '{}');
            let profileData = allProfiles[currentUser.username] || {
                name: currentUser.nickname, // Default name to nickname
                pfp: 'https://cdn.pixabay.com/photo/2016/09/28/02/14/user-1699635_1280.png', // Default anonymous PFP
                bio: '',
                status: 'active'
            };

            document.getElementById('profile-name').value = profileData.name;
            document.getElementById('profile-bio').value = profileData.bio;
            updateProfilePicture(profileData.pfp);
            updateProfileStatus(profileData.status);
        }

        function saveUserProfile() {
            if (!currentUser) {
                showToast('Please sign in to save your profile.', 'error');
                return;
            }

            let allProfiles = JSON.parse(localStorage.getItem(USER_PROFILE_KEY) || '{}');
            allProfiles[currentUser.username] = {
                name: document.getElementById('profile-name').value,
                pfp: document.getElementById('profile-pfp').src,
                bio: document.getElementById('profile-bio').value,
                status: document.querySelector('.profile-status-button.active')?.dataset.status || 'active'
            };
            localStorage.setItem(USER_PROFILE_KEY, JSON.stringify(allProfiles));
            showToast('Profile saved successfully!', 'success');
        }

        function updateProfilePicture(imageDataUrl) {
            const pfpImg = document.getElementById('profile-pfp');
            const pfpPlaceholder = document.getElementById('profile-pfp-placeholder');

            if (imageDataUrl && imageDataUrl !== 'https://cdn.pixabay.com/photo/2016/09/28/02/14/user-1699635_1280.png') { // Check if it's a valid image data URL
                pfpImg.src = imageDataUrl;
                pfpImg.classList.remove('hidden');
                pfpPlaceholder.classList.add('hidden');
            } else {
                pfpImg.src = 'https://cdn.pixabay.com/photo/2016/09/28/02/14/user-1699635_1280.png'; // Set to anonymous PFP
                pfpImg.classList.remove('hidden'); // Ensure image is shown
                pfpPlaceholder.classList.add('hidden'); // Hide placeholder
            }
        }

        function updateProfileStatus(status) {
            document.querySelectorAll('.profile-status-button').forEach(button => {
                button.classList.remove('active');
            });
            const activeButton = document.querySelector(`.profile-status-button[data-status="${status}"]`);
            if (activeButton) {
                activeButton.classList.add('active');
            }
        }

        // Event listener for PFP upload
        document.getElementById('pfp-upload').addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    updateProfilePicture(e.target.result);
                };
                reader.readAsDataURL(file);
            }
        });

        // Event listeners for status buttons
        document.querySelectorAll('.profile-status-button').forEach(button => {
            button.addEventListener('click', function() {
                updateProfileStatus(this.dataset.status);
            });
        });

        // Event listener for save profile button
        document.getElementById('profile-save-button').addEventListener('click', function() {
            saveUserProfile();
        });

        // --- About Us Page Animations ---
        function animateCount(elementId, start, end, duration) {
            const element = document.getElementById(elementId);
            let startTime = null;

            function easeOutQuad(t) {
                return t * (600 - t);
            }

            function animate(currentTime) {
                if (!startTime) startTime = currentTime;
                const progress = Math.min((currentTime - startTime) / duration, 1);
                const easedProgress = easeOutQuad(progress);
                const currentValue = Math.floor(easedProgress * (end - start) + start);
                element.textContent = currentValue.toLocaleString(); // Add comma separators
                if (progress < 1) {
                    requestAnimationFrame(animate);
                }
            }
            requestAnimationFrame(animate);
        }

        function generateRandomStars() {
            const rating = (Math.random() * (5 - 3.5) + 3.5).toFixed(1); // Random rating between 3.5 and 5.0
            let stars = '';
            const fullStars = Math.floor(rating);
            const halfStar = rating % 1 >= 0.5;

            for (let i = 0; i < fullStars; i++) {
                stars += '★';
            }
            if (halfStar) {
                stars += '☆'; // Using an empty star for half, or you could use a half-star character if available
            }
            return stars;
        }

        function animateCounts() {
            // Accounts Count - Use random value between 100-500
            const totalAccounts = Math.floor(Math.random() * 1) + 1; // Random between 100-500
            animateCount('accounts-count', 0, totalAccounts, 2000);

            // Transaction Rate
            document.getElementById('transaction-rating').textContent = generateRandomStars();

            // XLC Mined
            const totalXlcMined = Math.floor(Math.random() * 900) + 800; // Random between 100,000 and 1,000,000
            animateCount('xlc-mined-count', 0, totalXlcMined, 2000);

            // Ecosystem Connections - NEW IMPLEMENTATION
            const randomEcosystemConnections = Math.floor(Math.random() * (5000 - 5000 + 0)) + 1; // Random between 1,000 and 5,000
            animateCount('ecosystem-count', 0, randomEcosystemConnections, 2000);
        }

        // --- Authentication Functions ---
        const wordlist = [
            "apple", "banana", "cherry", "date", "elder", "fig", "grape", "honeydew", "kiwi", "lemon",
            "mango", "nectarine", "orange", "papaya", "quince", "raspberry", "strawberry", "tangerine", "ugli", "vanilla",
            "watermelon", "xigua", "yellow", "zucchini", "apricot", "blueberry", "cantaloupe", "dragonfruit", "eggplant", "fennel",
            "ginger", "huckleberry", "iceberg", "jicama", "kale", "lettuce", "mushroom", "nutmeg", "onion", "parsley",
            "quinoa", "radish", "spinach", "tomato", "turnip", "umbrella", "violet", "walnut", "yam", "zest",
            "brave", "clever", "daring", "eager", "fierce", "gentle", "happy", "jolly", "kind", "lively",
            "merry", "noble", "optimistic", "peaceful", "quick", "radiant", "swift", "true", "unique", "vivid",
            "wise", "youthful", "zealous", "calm", "dreamy", "elegant", "funny", "graceful", "humble", "innocent",
            "joyful", "keen", "lucky", "modest", "neat", "open", "patient", "quiet", "relaxed", "sincere",
            "thoughtful", "upbeat", "vibrant", "warm", "xenial", "yielding", "zany", "bright", "crisp", "delight",
            "echo", "flame", "glow", "haze", "ivy", "jewel", "kismet", "lunar", "mist", "nova",
            "ocean", "petal", "quill", "river", "star", "tide", "umbra", "vortex", "wave", "xylem",
            "yonder", "zenith", "breeze", "cloud", "dew", "earth", "forest", "glade", "hill", "island",
            "jungle", "lagoon", "mountain", "nature", "oasis", "peak", "ridge", "stream", "trail", "valley",
            "wind", "aurora", "blossom", "cascade", "dusk", "emerald", "flicker", "glimmer", "horizon", "iridescent",
            "jubilant", "luminous", "meadow", "nebula", "orchid", "prism", "quiver", "ripple", "solstice", "twilight",
            "universe", "vibrant", "whisper", "xylophone", "yearn", "zodiac", "ancient", "bold", "charming", "divine",
            "eternal", "fabled", "grand", "heroic", "ideal", "just", "legend", "majestic", "mystic", "natural",
            "old", "pure", "quaint", "royal", "sacred", "timeless", "unseen", "vast", "wild", "young",
            "zesty", "abundant", "bliss", "candid", "dawn", "essence", "fathom", "glorious", "harmony", "infinite",
            "journey", "karma", "liberty", "marvel", "nirvana", "omen", "paradise", "quest", "reverie", "serene",
            "tranquil", "utopia", "valor", "wonder", "xenodochial", "yearning", "zestful"
        ];

        function generateSeedPhrase() {
            let phrase = [];
            const usedPhrases = new Set(JSON.parse(localStorage.getItem('used_seed_phrases') || '[]'));
            let attempts = 0;
            const maxAttempts = 1000; // Prevent infinite loop in case of extreme collision

            while (phrase.length < 6 && attempts < maxAttempts) {
                const randomIndex = Math.floor(Math.random() * wordlist.length);
                const word = wordlist[randomIndex];
                if (!phrase.includes(word)) { // Ensure unique words within the phrase
                    phrase.push(word);
                }
                attempts++;
            }
            
            const generatedPhrase = phrase.join(' ');
            if (usedPhrases.has(generatedPhrase)) {
                // If generated phrase is already used, try again (recursive call, but with caution)
                return generateSeedPhrase(); 
            }
            
            document.getElementById('generated-seed-phrase').textContent = generatedPhrase;
            return generatedPhrase;
        }

        function showAuthModal(type) {
            document.getElementById('auth-modal').classList.add('show');
            if (type === 'signin') {
                document.getElementById('auth-modal-title').textContent = 'Sign In';
                document.getElementById('signin-form').classList.remove('hidden');
                document.getElementById('signup-form').classList.add('hidden');
            } else {
                document.getElementById('auth-modal-title').textContent = 'Sign Up';
                document.getElementById('signin-form').classList.add('hidden');
                document.getElementById('signup-form').classList.remove('hidden');
                generateSeedPhrase(); // Generate a new seed phrase for signup
            }
        }

        function hideAuthModal() {
            document.getElementById('auth-modal').classList.remove('show');
            // Clear form fields
            document.getElementById('signin-username').value = '';
            document.getElementById('signin-seedphrase').value = '';
            document.getElementById('signup-username').value = '';
            document.getElementById('signup-nickname').value = '';
            document.getElementById('generated-seed-phrase').textContent = '';
        }

        function validateUsername(username) {
            // Minimal 1 lower, 1 upper, 1 special character, 1 number
            const hasLower = /[a-z]/.test(username);
            const hasUpper = /[A-Z]/.test(username);
            const hasNumber = /[0-9]/.test(username);
            const hasSpecial = /[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(username);
            return hasLower && hasUpper && hasNumber && hasSpecial;
        }

        function signUp() {
            const username = document.getElementById('signup-username').value.trim();
            const nickname = document.getElementById('signup-nickname').value.trim();
            const seedPhrase = document.getElementById('generated-seed-phrase').textContent.trim();

            if (!username || !nickname || !seedPhrase) {
                showToast('All fields are required!', 'error');
                return;
            }

            if (!validateUsername(username)) {
                showToast('Username must contain at least one lowercase letter, one uppercase letter, one number, and one special character.', 'error');
                return;
            }

            let accounts = JSON.parse(localStorage.getItem(ACCOUNTS_KEY) || '{}');
            if (accounts[username]) {
                showToast('Username already exists!', 'error');
                return;
            }

            // Check if seed phrase is already used (should be unique)
            let usedPhrases = new Set(JSON.parse(localStorage.getItem('used_seed_phrases') || '[]'));
            if (usedPhrases.has(seedPhrase)) {
                showToast('Generated seed phrase is already in use. Please generate a new one.', 'error');
                generateSeedPhrase(); // Generate a new one if collision detected
                return;
            }

            accounts[username] = {
                nickname: nickname,
                seedPhrase: seedPhrase,
                createdAt: new Date().toISOString()
            };
            localStorage.setItem(ACCOUNTS_KEY, JSON.stringify(accounts));

            usedPhrases.add(seedPhrase);
            localStorage.setItem('used_seed_phrases', JSON.stringify(Array.from(usedPhrases)));

            showToast('Account created successfully! Please sign in.', 'success');
            hideAuthModal();
            showAuthModal('signin');
        }

        function signIn() {
            const username = document.getElementById('signin-username').value.trim();
            const seedPhrase = document.getElementById('signin-seedphrase').value.trim();

            if (!username || !seedPhrase) {
                showToast('All fields are required!', 'error');
                return;
            }

            let accounts = JSON.parse(localStorage.getItem(ACCOUNTS_KEY) || '{}');
            const account = accounts[username];

            if (!account || account.seedPhrase !== seedPhrase) {
                showToast('Invalid username or seed phrase!', 'error');
                return;
            }

            currentUser = { username: username, nickname: account.nickname };
            localStorage.setItem(CURRENT_USER_KEY, JSON.stringify(currentUser));
            
            showToast(`Welcome back, ${currentUser.nickname}!`, 'success');
            hideAuthModal();
            updateAuthUI();
            updateChatGreeting();
            updateNotesUI(); // Enable notes for signed-in user
            updateProfileUI(); // Enable profile for signed-in user
            updateVaultUI(); // Enable vault features
            checkProPlanStatus(); // Check pro plan status on sign in
        }

        function signOut() {
            currentUser = null;
            localStorage.removeItem(CURRENT_USER_KEY);
            showToast('Signed out successfully!', 'info');
            updateAuthUI();
            updateChatGreeting(); // Reset greeting
            updateNotesUI(); // Disable notes
            updateProfileUI(); // Disable profile
            updateVaultUI(); // Disable vault features
            isProPlanActive = false; // Reset pro plan status
            updatePricingPageUI(); // Update pricing UI on sign out
            checkAndDisplayResponseLimit(); // Reset chat input based on basic plan
            switchPage('chat'); // Redirect to chat page
        }

        function updateAuthUI() {
            const authButton = document.getElementById('auth-button');
            const authButtonText = document.getElementById('auth-button-text');
            const profileNavButton = document.querySelector('#sidebar button[onclick="switchPage(\'profile\')"]');
            const profileNavImg = profileNavButton.querySelector('img');

            if (currentUser) {
                authButton.onclick = signOut;
                authButtonText.textContent = 'Sign Out';
                profileNavImg.src = 'https://cdn.pixabay.com/photo/2016/09/28/02/14/user-1699635_1280.png'; // Placeholder for user PFP
                // You might want to load the actual user PFP here if stored
            } else {
                authButton.onclick = () => showAuthModal('signin');
                authButtonText.textContent = 'Sign In';
                profileNavImg.src = 'https://cdn.pixabay.com/photo/2016/09/28/02/14/user-1699635_1280.png'; // Default anonymous PFP
            }
        }

        // --- Sidebar Functions ---
        function openSidebar() {
            document.getElementById('sidebar').classList.add('open');
        }

        function closeSidebar() {
            document.getElementById('sidebar').classList.remove('open');
        }

        // --- Vault Page Functions ---
        let orbitAnimationIntervals = []; // To store animation intervals

        function startOrbitAnimations() {
            const orbitRings = document.querySelectorAll('.orbit-ring');
            const animationDurations = [15, 20, 25, 30]; // Different durations for each ring
            const animationNames = [
                ['rotateOrbit1-cw', 'rotateOrbit1-ccw'],
                ['rotateOrbit2-cw', 'rotateOrbit2-ccw'],
                ['rotateOrbit3-cw', 'rotateOrbit3-ccw'],
                ['rotateOrbit4-cw', 'rotateOrbit4-ccw']
            ];

            orbitRings.forEach((ring, index) => {
                const direction = ring.dataset.direction; // 'cw' or 'ccw'
                const animationName = animationNames[index][direction === 'cw' ? 0 : 1];
                const duration = animationDurations[index];

                // Apply animation
                ring.style.animation = `${animationName} ${duration}s linear infinite, ringPulse 3s infinite ease-in-out`;
            });
        }

        function stopOrbitAnimations() {
            const orbitRings = document.querySelectorAll('.orbit-ring');
            orbitRings.forEach(ring => {
                ring.style.animation = 'none'; // Remove all animations
            });
        }

        function updateVaultUI() {
            const vaultContent = document.querySelector('#vault .vault-container');
            const noUserMessage = document.getElementById('vault-no-user-message');
            const simulateBtn = document.getElementById('simulate-ai-interaction-btn');

            if (currentUser) {
                vaultContent.classList.remove('hidden');
                noUserMessage.classList.add('hidden');
                simulateBtn.disabled = false;
                updateXlcDisplay();
            } else {
                vaultContent.classList.remove('hidden'); // Keep vault content visible
                noUserMessage.classList.remove('hidden'); // Show message
                simulateBtn.disabled = true; // Disable button for non-signed-in users
                document.getElementById('xlc-token-display').textContent = 'Please sign in to stack XLC Tokens.';
            }
        }

        // Initial calls on DOMContentLoaded
        document.addEventListener('DOMContentLoaded', function() {
            // Load current user
            const savedUser = localStorage.getItem(CURRENT_USER_KEY);
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
            }

            // Set initial active nav item based on currentPage
            const initialNavItem = document.querySelector(`#sidebar button[onclick="switchPage('${currentPage}')"]`);
            if (initialNavItem) {
                initialNavItem.classList.add('active');
            }

            if (currentPage === 'about') {
                document.querySelectorAll('.team-member').forEach((member, index) => {
                    setTimeout(() => {
                        member.classList.add('visible');
                    }, index * 200);
                });
            }
            
            // Load chat history from generic key
            const savedHistory = localStorage.getItem(CHAT_HISTORY_KEY);
            if (savedHistory) {
                chatHistory = JSON.parse(savedHistory);
                const chatIds = Object.keys(chatHistory);
                if (chatIds.length > 0) {
                    currentChatId = Math.max(...chatIds.map(id => parseInt(id)));
                    chatCounter = chatIds.length;
                } else {
                    currentChatId = 1;
                    chatCounter = 1;
                    chatHistory[currentChatId] = {
                        id: currentChatId,
                        title: "Chat 1",
                        messages: [
                            {
                                content: "Hello! How can I help you today?",
                                isUser: false,
                                timestamp: new Date()
                            }
                        ],
                        created: new Date()
                        };
                }
            } else {
                chatHistory = {};
                currentChatId = 1;
                chatCounter = 1;
                chatHistory[currentChatId] = {
                    id: currentChatId,
                    title: "Chat 1",
                    messages: [
                        {
                            content: "Hello! How can I help you today?",
                            isUser: false,
                            timestamp: new Date()
                        }
                    ],
                    created: new Date()
                };
            }
            loadChatMessages();

            updateChatGreeting(); // Update greeting on load
            initializeResponseLimit();
            loadUserNotes(); // Load notes for the current session
            loadUserProfile(); // Load profile for the current session
            updateNotesUI(); // Initial update for notes page visibility
            updateProfileUI(); // Initial update for profile page visibility
            updateAuthUI(); // Initial update for auth button state
            updateXlcDisplay(); // Initial update for XLC tokens
            updateVaultUI(); // Initial update for vault page visibility
            checkProPlanStatus(); // Initial check for Pro Plan status

            // If the initial page is 'about-us', trigger animations
            if (currentPage === 'about-us') {
                animateCounts();
            }

            // Add event listeners for sidebar toggle and close
            document.getElementById('sidebar-toggle').addEventListener('click', openSidebar);
            document.getElementById('sidebar-close-btn').addEventListener('click', closeSidebar);
            document.getElementById('simulate-ai-interaction-btn').addEventListener('click', simulateAiInteraction);

            // Add event listener for planet container to start/stop animations on click
            document.getElementById('planet-container').addEventListener('click', function() {
                const orbitRings = document.querySelectorAll('.orbit-ring');
                const isAnimating = orbitRings[0].style.animationPlayState === 'running';

                if (isAnimating) {
                    orbitRings.forEach(ring => ring.style.animationPlayState = 'paused');
                } else {
                    orbitRings.forEach(ring => ring.style.animationPlayState = 'running');
                }
            });
        });
</script>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const sidebar = document.getElementById('sidebar');
    const toggleBtn = document.getElementById('sidebar-toggle');
    const closeBtn = document.getElementById('sidebar-close-btn');

    // Buka sidebar
    toggleBtn.addEventListener('click', function () {
      sidebar.classList.add('open');
    });

    // Tutup sidebar
    closeBtn.addEventListener('click', function () {
      sidebar.classList.remove('open');
    });
  });
</script>
</body>
</html>
